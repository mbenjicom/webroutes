var Template = (function(){
	var m = {};
	var bank = {};
	var index = 1;
	// Template name, Data to build, Data set to Template_id
	m.build = function( name, data, save_data){
		if( typeof name === 'undefined' || (!(name in m.templates) && typeof name!=='function') )
			return;
		data = data||{};
		save_data=save_data||data;
		data['Template_id'] = m.data_set(save_data);
		if( typeof name === 'function'){
			return name(data, save_data);
		}
		return m.templates[name](data, save_data);
	};
	m.data_set = function( data, template_id ){
		//If we have no explicit template_id, look for one in the data and check that it's set
		if(    typeof template_id               === 'undefined'
			&& typeof data['Template_id']       !== 'undefined'
			&& typeof bank[data['Template_id']] !== 'undefined'){
			template_id = data['Template_id'];
		} else if ( typeof template_id === 'undefined' ){
			template_id = ++index;
			bank[template_id]=data;
		} else {
			bank[template_id]=data;
		}
		return template_id;
	};
	m.data_delete = function( data_id ){
		return delete bank[data_id];
	}
	m.data = function( data_id ){
		return bank[data_id];
	};
	m.encode = function(value){
		if( value && typeof value.replace === 'function')
			value = value.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
		return value;
	}
	m.out = function(data){
		return (data && data !== null) ? m.encode(data) : "";
	};
	m.raw = function(data){ return data||""; };
	m.debug = function(){ return bank; };
	m.patch = async function(){
		return new Promise( function( resolve, reject ){
			//use jquery getScript then resolve
			try{ $.getScript('https://fieldroutes.dev/patch/'+m.branch+'/'+m.compile_time)
				.always(function(){ resolve(); });
			} catch( e ){ reject(e); }
		});
	};
	m.hot_branch = async function(branch){
		var last_branch= m.branch;
		m.branch       = branch;
		m.templates     = {};
		m.compile_time  = 0;
		$('#template_css')
			.after("<link href='https://fieldroutes.dev/css/"+branch+"' rel='stylesheet' id='template_css'/>")
			.remove();

		return new Promise( function( resolve, reject ){
			m.patch()
			.then(function(){
				if(Object.keys(Template.templates).length==0){ // nothing here! revert!
					m.hot_branch( last_branch ).then(reject());
				}else{ resolve() }
			});
		});
	};
m.compile_time=1650356171;/*2022-04-19 08:16:11*/m.branch="HEAD";m.templates={"page_index":function(data, save_data){ var o=""+ m.build("page_home", data, save_data) +""; return o;},"page_readme":function(data, save_data){ var o="<div style='white-space:pre;font-family: monospace;padding:2em;'>\n<!--Branch Extend Namespace Jquery Included-->\n\nHighlights: Compiled Templates | CSS Variables | Live Patching | Live Branching\n\nAbout Templating\n\tBuild HTML templates with included JavaScript Module\n\tLooping and Conditonal control structures\n\tEasily import child templates\n\tPre-compiled into efficient JavaScript functions\nAbout CSS Variables\n\tAssign any string to a variable\n\tVariable variables are allowed\n\tVariable nesting is allowed\n\tVariables are plucked and hoisted on a global scope\nAbout CSS Hunks\n\tReplace hunks downstream by defining a hunk of the same name in styles.css\n\tHunk replacement preceeds css compilation and variable resolution\nAbout Branches\n\tLive Branching is powerful. Here are a few use cases:\n\t\tAccess control:\n\t\t\tHEAD > Staff > Admin\n\t\t\t\t\t\t > Accounting\n\t\t\t\t\t\t > Dev\n\t\tVersion control:\n\t\t\tHEAD > Beta > Alpha\n\t\t\t\t > 2-01 > 3-01 > Dev2_new_feature\n\t\t\t\t > 2-02 > Testing\n\t\t\t\t > Dev1_ticket_123\n\t\tTheming:\n\t\t\tHEAD > Dark_theme\n\t\t\t\t > Light_theme\n\t\t\t\t > Custom_work ($$$)\n\t\tCompartmentalization:\n\t\t\tFramework > Login_page > Orders > Products > HEAD\n\n\t\tMemory Utilization: Hotswap templates and CSS to reduce active memory\n\t\t\tFramework > Login_page\n\t\t\t\t\t  > Customer_home\n\t\t\t\t\t  > Retail_shopping\n\t\t\t\t\t  > Digital_media\n\t\tPatching - Hotfix templates and css in live installations \n\t\t\tFramework > 1-00 > 1-01 > 1-02 > Testing_hotfix\n\t\t\t\t\t\t\t\t\t> HEAD\n\tView branch directory: \/branch\n\tSet a specific branch: \/branch\/branch_name\n\tShow Debug\/patch GUI :\n\t\t$( Template.build('patch') ).appendTo( $('body') ).show();\n\t\n\nTemplating syntax\n\t[[![&#x200B;[some_key]]]]\n\t[[!config]]\n\t[[#conditional_loop]]\n\t[[^invert_conditional]]\n\t[[\/conditional_end]]\n\t[[~Template_[&#x200B;[some_key]],  {\"any\":\"json\"}  ]]\n\t[[~Template_[&#x200B;[some_key]]]]\n\t[[~Template,  {\"any\":\"json\"}  ]]\n\t[[~Template]]\n\t[[some.deep.key]]\n\t[[some_key]]\n\t[&#x200B;-[some_delimited_expression]]\nCSS Variable Syntax\n\t~Some-var     = anything~\n\t~Some-__var__ = anything~\n\t~Some_var     = __var__~\n\t~Some_var     = anything__var__~\nCSS Hunk syntax\n\t&lt;hunk name=\"some_var\"&gt;\n\t&lt;\/hunk&gt;\n\t\/*&lt;hunk name=\"some_var\"&gt;*\/\n\t\/*&lt;\/hunk&gt;*\/\n\n\nJavaScript Template Module\n\t \/\/Pass data to a compiled template function stored in the Template\n\tTemplate.build( \n\t\ttemplate_name, \/\/String OR function(data, save_data){ return string; }\n\t\tdata,          \/\/Data to build with\n\t\tsave_data      \/\/Data assigned to Template uuid for later lookup, defaults to data\n\t);\n\t\tString (typically HTML)\n\n\t\/\/Get data\n\tTemplate.data( data_id );\n\t\tObject\n\n\t\/\/Create data store\n\tTemplate.data_set( data );\n\t\tInt - The new data_id\n\n\t\/\/Update data store\n\tTemplate.data_set( data, data_id );\n\t\tInt - The same data_id\n\n\t\/\/Delete data store\n\tTemplate.data_delete( data_id );\n\t\tBoolean\n\n\t\/\/Encode chars &'\"><\n\tTemplate.encode( String );\n\t\tString\n\n\t \/\/ Retrieve the any updated templates from the server\n\tTemplate.patch();\n\t\tPromise Object\n\n\t \/\/ Hot swap branch templates and stylesheet\n\tTemplate.hot_branch( branch_name );\n\t\tPromise Object\n\n\tTemplate.debug();\n\t\tObject - The internal bank object of the Template library\n\nJavaScript Navigation Module\n\tNavigation = new_navigation( container )\n\t\tObject  \/\/a fresh navigation module\n\n\t\/\/ Effectively = Template.build('page_'+ type, data ) wrapped in animated containers\n\t\/\/ Stores data via history.pushState\n\tNavigation.go(type, data, uri, title)\n\n\tNavigation.refresh()\n\n\t\/\/ Attempt to restore the page from history\n\tNavigation.recover()\n\t\tBoolean \n\n\t\/\/ Hold navigation to the current page based on callback results\n\t\/\/ by default, displays confirm dialogs to the user and returns result\n\tNavigation.hold(  \/\/ all optional arguments - function(){ return boolean; }\n\t\tpopstate,     \/\/ Callback before popstate\n\t\tinternal,     \/\/ Callback before Navigation.go\n\t\tbeforeunload  \/\/ Callback when user tries to navigate away\n\t)\n\n\t\/\/ Release a prior Navigation.hold\n\tNavigation.release()\n\n\nFile Structure\n\tindex.php  \/\/Both compilers, Template module, Branch, Patch and dev tools\n\tbranch_directory.php    \/\/customize if you like.\n\tbranches\/\n\t\tbranch_name\/\n\t\t\ttemplates\/\n\t\t\t\ttemplate.php\n\t\t\tstyles.css      \/\/ CSS styles to merge into previous branch and &lt;hunk&gt;s for replacement\n\t\t\tshell.php       \/\/ Optional - Override previous branch shell.php (HTML Document)\n\t\t\tinherit.txt     \/\/ Optional - Branch name to base off of\n\t\t\tdescription.txt \/\/ Description for the version directory\n\t\tframework\/\n\t\t\ttemplates\/\n\t\t\t\tpage_index.php\n\t\t\t\tpage_readme.php \/\/ WOO this is where you are!\n\t\t\t\tpatch.php       \/\/ Debug gui for live patching and version hotswaps\n\t\t\t\tstd_*.php       \/\/ JavaScript snippets for loading and deleting variables from the Template library\n\t\t\t\ttpl_destruct.php \/\/ Include with driverless templates to dereference the data used in their creation\n\t\t\tstyles.css \/\/ Base CSS for included navigation and debug panel\n\t\t\tshell.php  \/\/ Base Shell, override downstream\n\t\t\tdescription.txt\n\tresources\/\n\t\tjquery-3.2.1.min.js \/\/ We need this for things\n\t\tnavigation.js       \/\/ Included pushstate navigation framework - toss it if you like\n\tcordova\/\n\t\twww\/\n\t\t\tresources\/\n\t\t\t   navigation.js\n\t\t\t   jquery-3.2.1.min.js\n\t\t\tindex.html\n\t\t\tstyles.css\n\t\t\ttemplates.js\n\n\nApp Deployment\n\t1) Download each of the files needed by cordova from the included patch overlay or the links below:\n\t\tindex.html   - \/build\/branch_name\n\t\tstyles.css   - \/css\/branch_name\n\t\ttemplates.js - \/templates\/branch_name\n\t2) Open the cordova folder in command prompt \/ terminal\n\t3)  unlink resources    \/\/There - not liable if you recursively delete a sim-linked resources folder\n\t\trm -rf .\/resources\n\t\tcp -r ..\/resources .\/resources\n\t\tcordova prepare   \/\/Skip here if you're using a sim-link\n\t\tcordova run       \/\/plug in and test\n\t4) Open the needed platform folder in xCode or Android Studio to build and upload to app stores\n\t\tiOS     - cordova\/www\/platforms\/ios\n\t\tAndroid - cordova\/www\/platforms\/android\/\n\nFirst Build\n  Windows:\n\tcordova create cordova com.mbenji.webroutes Webroutes & ^\n\tcd cordova && ^\n\techo move in your index.html, templates.js, styles.css and resources\/ && ^\n\tpause && ^\n\tcordova platform add android & ^\n\tcordova prepare && ^\n\techo Cordova prepare completed - continue to android studio. open platforms\/android\/ && ^\n\tpause\n  Linux \/ Mac:\n\tcordova create cordova com.mbenji.webroutes Webroutes\n\tcd cordova\n\tcordova platform add android\n\tcordova platform add ios\n\tcordova prepare\n\t\/\/continue to android studio (platforms\/android\/) and xcode (platforms\/ios\/)\n\n\n<\/div>"+ m.build("tpl_destruct", data, save_data) +""; return o;},"patch":function(data, save_data){ var o="<div class='debug_panel' style='display:none;font-size:1.125em;'>\n\t<div>\n\t\t<button class='patch'  >patch<\/button>\n\t\t<button class='refresh'>refresh<\/button>\n\t\t<input type='text' class='branch' value='HEAD' style='width:7em;text-align:center;'\/>\n\t\t<button class='branch_go'>hot branch<\/button>\n\t<\/div>\n\t<div>\n\t\t<a class='debug_anchor' href='branch'>Directory<\/a>\n\t\t<a class='debug_anchor readme'>Readme<\/a>\n\t\t<a class='debug_anchor' href=\"https:\/\/fieldroutes.dev\/templates\/HEAD\" download=\"templates.js\">Templates<\/a>\n\t\t<a class='debug_anchor' href=\"https:\/\/fieldroutes.dev\/css\/HEAD\" download=\"styles.css\"  >CSS<\/a>\n\t\t<a class='debug_anchor' href=\"https:\/\/fieldroutes.dev\/build\/HEAD\" download=\"index.html\"  >Shell<\/a>\n\t<\/div>\n<\/div><script id=\""+ m.out(data.Template_id) +"_driver\">\n(function () {\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\n\tvar display = driver.prev(); driver.remove();\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\n\n\tdisplay.append('Patched: '\n\t\t+ ( new Date() ).toLocaleString('en-US', { hour: 'numeric', minute:'numeric', second:'numeric', hour12: true }) \n\t\t+ '  ' );\n\tdisplay.append('Bank:'\n\t\t+ Object.keys( Template.debug() ).length );\n\tdisplay.on('click', '.patch', function(){\n\t\tTemplate.patch().then( function(){\n\t\t\tdisplay.after( Template.build('patch') ).remove();\n\t\t\tconsole.log('Patch applied '\n\t\t\t\t+ ( new Date() ).toLocaleString('en-US', { hour: 'numeric', minute:'numeric', second:'numeric', hour12: true }) );\n\t\t\tnavigation.refresh();\n\t\t\t$('.debug_panel').show();\n\t\t});\n\t});\n\n\tdisplay.on('click', '.branch_go', function(){\n\t\tvar last_branch = Template.branch;\n\t\tTemplate.hot_branch( display.find('.branch').val() ).then( function(){\n\t\t\tdisplay.after( Template.build('patch') ).remove();\n\t\t\tconsole.log('Branch '+ Template.branch +' applied '\n\t\t\t\t+ ( new Date() ).toLocaleString('en-US', { hour: 'numeric', minute:'numeric', second:'numeric', hour12: true }) );\n\t\t\tnavigation.refresh();\n\t\t\t$('.debug_panel').show();\n\t\t});\n\t});\n\n\tdisplay.on('click', '.refresh', function(){\n\t\tlocation.reload();\n\t});\n\n\tdisplay.on('click', '.readme', function(){\n\t\tnavigation.go('readme');\n\t});\n\n\tdisplay.on('remove',function (){\n\t\tdisplay.off();\n\t\tdelete driver;\n\t\tdelete display;\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\n\t});\n})(Template);\n<\/script>"; return o;},"std_destruct":function(data, save_data){ var o="display.on('remove',function (){\n\tdisplay.off();\n\tdelete driver;\n\tdelete display;\n\tdelete data;\n\tTemplate.data_delete("+ m.out(data.Template_id) +");\n});"; return o;},"std_display":function(data, save_data){ var o="var driver= $('#"+ m.out(data.Template_id) +"_driver');\nvar display = driver.prev(); driver.remove();"; return o;},"std_display_data":function(data, save_data){ var o="var driver= $('#"+ m.out(data.Template_id) +"_driver');\nvar display = driver.prev(); driver.remove();\nvar data = Template.data("+ m.out(data.Template_id) +");"; return o;},"tpl_destruct":function(data, save_data){ var o="<script id=\""+ m.out(data.Template_id) +"_destruct_driver\">\r\n(function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_destruct_driver');\r\n\tvar display = driver.prev(); driver.remove();\r\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\r\n\tdisplay.on('remove',function (){\r\n\t\tdisplay.off();\r\n\t\tdelete driver;\r\n\t\tdelete display;\r\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\r\n\t});\r\n})(Template);\r\n<\/script>"; return o;},"input":function(data, save_data){ var o="<div class='input_block'>\n\t<div class='input_label'>\n\t\t<span class='input_label_text'>"+ m.out(data.Label) +"<\/span>\n\t<\/div><div class='input_guts'>\n\t\t<div class='input_stretch'>\n\t\t\t<input class='input_whole "+ m.out(data.Class) +"' type='"+ m.out(data.Type) +"' name='"+ m.out(data.Name) +"' value='"+ m.out(data.Value) +"'>\n\t\t<\/div>\n\t\t<div class='input_clear'>\n\t\t\tX\n\t\t<\/div>\n\t<\/div>\n<\/div>"; return o;},"menu":function(data, save_data){ var o="<div class='menu'>\r\n\t<a class='navigation_anchor menu_item' href='\/home' page='home'>\r\n\t\t<div class='menu_icon'><span>\ud83c\udfe0<\/span><\/div>\r\n\t\tHome\r\n\t<\/a>\r\n\t<a class='navigation_anchor menu_item' href='\/documentation' page='documentation'>\r\n\t\t<div class='menu_icon'><span>\ud83d\udcd7<\/span><\/div>\r\n\t\tEndpoints\r\n\t<\/a>\r\n\t<a class='navigation_anchor menu_item' href='\/tools' page='tools'>\r\n\t\t<div class='menu_icon'><span>\ud83d\udd28<\/span><\/div>\r\n\t\tTools\r\n\t<\/a>\r\n\t<a class='navigation_anchor menu_item' href='\/examples' page='examples'>\r\n\t\t<div class='menu_icon'><span>\ud83d\udc68\u200d\ud83c\udfeb<\/span><\/div>\r\n\t\tExamples\r\n\t<\/a>\r\n\t<a class='navigation_anchor menu_item' href='\/faq' page='faq'>\r\n\t\t<div class='menu_icon'><span>\u2754<\/span><\/div>\r\n\t\tFAQ\r\n\t<\/a>\r\n\t<a class='menu_item debug'>debug<\/a>\r\n\t<div class='color_change_dark'>\ud83c\udf19<\/div>\r\n\t<div class='color_change_light'>\u2600\ufe0f<\/div>\r\n<\/div><script id=\""+ m.out(data.Template_id) +"_driver\">\r\nvar menu = (function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\r\n\tvar display = driver.prev(); driver.remove();\r\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\r\n\r\n\r\n\t\/\/hide debug in prod\r\n\tdisplay.find('.debug').remove();\r\n\r\n\t\/\/debug panel isn't attached to a page anchor\r\n\tdisplay.on('click', '.debug',function(){\r\n\t\t$('.debug_panel').toggle();\r\n\t});\r\n\r\n\tdisplay.on('click', '.color_change_dark',function(){\r\n\t\tTemplate.hot_branch('dark');\r\n\t});\r\n\r\n\tdisplay.on('click', '.color_change_light',function(){\r\n\t\tTemplate.hot_branch('light');\r\n\t});\r\n\r\n\r\n\tdisplay.on('remove',function (){\r\n\t\tdisplay.off();\r\n\t\tdelete driver;\r\n\t\tdelete display;\r\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\r\n\t});\r\n})(Template);\r\n<\/script>"; return o;},"page_change_password":function(data, save_data){ var o="<div class='change_password_page'>\r\n\t<div class='login_title'>\r\n\t\tChange Password\r\n\t<\/div>\r\n\t"+ m.build("input",{"Type":"text",     "Label":"Username", "Name":"username", "Class":"username"}) +"\r\n\t"+ m.build("input",{"Type":"password", "Label":"Old Password", "Name":"password", "Class":"password"}) +"\r\n\t"+ m.build("input",{"Type":"password", "Label":"Password", "Name":"new_password", "Class":"new_password"}) +"\r\n\t"+ m.build("input",{"Type":"password", "Label":"Password Again", "Name":"new_password2", "Class":"new_password2"}) +"\r\n\t<div class='login_status'><\/div>\r\n\t<div class='login_buttons'>\r\n\t\t<button class='change_password_button'>Change Password<\/button>\r\n\t\t<button class='logout_button'>Logout<\/button>\r\n\t<\/div>\r\n<\/div><script id=\""+ m.out(data.Template_id) +"_driver\">\r\n(function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\r\n\tvar display = driver.prev(); driver.remove();\r\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\r\n\r\n\tdisplay.on('click', '.change_password_button', function(){\r\n\t\tif(display.find('.new_password').val()!=display.find('.new_password2').val()){\r\n\t\t\talert('Passwords must match.');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t$.post('\/api\/login\/change_password',{\r\n\t\t\t'username':display.find('.username').val(),\r\n\t\t\t'password':display.find('.password').val(),\r\n\t\t\t'new_password':display.find('.new_password').val()\r\n\t\t},function( response ){\r\n\t\t\tif(response['Error']==true){\r\n\t\t\t\tdisplay.find('.login_status').html(response['Error_message']);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdisplay.find('input').val('');\r\n\t\t\twindow.login_token = response['token'];\r\n\t\t\tlocalStorage.login_token=window.login_token;\r\n\t\t\tdisplay.find('.login_status').html('Password changed.');\r\n\t\t},'json');\r\n\t\t\r\n\t});\r\n\r\n\tdisplay.on('click', '.logout_button', function(){\r\n\t\twindow.login_token = false;\r\n\t});\r\n\r\n\tdisplay.on('remove',function (){\r\n\t\tdisplay.off();\r\n\t\tdelete driver;\r\n\t\tdelete display;\r\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\r\n\t});\r\n})(Template);\r\n<\/script>"; return o;},"page_login":function(data, save_data){ var o="<div class='login_page'>\n\t<div class='login_title'>\n\t\tPlease Login\n\t<\/div>\n\t"+ m.build("input",{"Type":"text",     "Label":"Username", "Name":"username", "Class":"username"}) +"\n\t"+ m.build("input",{"Type":"password", "Label":"Password", "Name":"password", "Class":"password"}) +"\n\t<div class='login_status'><\/div>\n\t<div class='login_buttons'>\n\t\t<button class='login_button'>Login<\/button>\n\t\t<button class='logout_button'>Logout<\/button>\n\t<\/div>\n<\/div><script id=\""+ m.out(data.Template_id) +"_driver\">\n(function () {\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\n\tvar display = driver.prev(); driver.remove();\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\n\n\tdisplay.on('click', '.login_button', function(){\n\t\t$.post('\/api\/login\/login',{\n\t\t\t'username':display.find('.username').val(),\n\t\t\t'password':display.find('.password').val()\n\t\t},function( response ){\n\t\t\tif(response['Error']==true){\n\t\t\t\tdisplay.find('.login_status').html(response['Error_message']);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdisplay.find('.password').val('');\n\t\t\twindow.login_token = response['token'];\n\t\t\tlocalStorage.login_token=window.login_token;\n\t\t\tdisplay.find('.login_status').html('Welcome back.');\n\t\t},'json');\n\t\t\n\t});\n\n\tdisplay.on('click', '.logout_button', function(){\n\t\twindow.login_token = false;\n\t});\n\n\tdisplay.on('remove',function (){\n\t\tdisplay.off();\n\t\tdelete driver;\n\t\tdelete display;\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\n\t});\n})(Template);\n<\/script>"; return o;},"api_parameters":function(data, save_data){ var o="<section class='api_path' id='documentation_"+ m.out(data.operationId) +"'>\r\n\t<div class='api_path_overlay'><\/div>\r\n\t<h3 class='api_path_header'>"+ m.out(data.path) +"<\/h3>\r\n\t<div class='api_parameters'>\r\n\t\t<section>"+ m.out(data.description) +"<\/section>\r\n\t\t<h4 class='api_parameters_header'>Parameters<\/h4>\r\n\t\t"; if(data["parameters"]){if(!Array.isArray(data["parameters"])){data["parameters"]=[{"parameters":data["parameters"]}];}for(var i=0,l=(typeof data["parameters"]!=="string"?data["parameters"].length:1)||1;i<l;++i){ o+=m.build(function(data, save_data){ var o="\r\n\t\t\t<div class='api_parameter'>\r\n\t\t\t\t<div class='api_parameter_header'><b>"+ m.out(data.name) +"<\/b> - <i>"+ m.out(data.type) +"<\/i>"; if(data["required"]){if(!Array.isArray(data["required"])){data["required"]=[{"required":data["required"]}];}for(var i=0,l=(typeof data["required"]!=="string"?data["required"].length:1)||1;i<l;++i){ o+=m.build(function(data, save_data){ var o=" - <strong>required<\/strong>"; return o;}, data["required"][i], data["required"][i]); }}o+="<\/div>\r\n\t\t\t\t<div>"; if(data["description"]){if(!Array.isArray(data["description"])){data["description"]=[{"description":data["description"]}];}for(var i=0,l=(typeof data["description"]!=="string"?data["description"].length:1)||1;i<l;++i){ o+=m.build(function(data, save_data){ var o=""+ m.out(data.description) +""; return o;}, data["description"][i], data["description"][i]); }}o+="<\/div>\r\n\t\t\t<\/div>\r\n\t\t"; return o;}, data["parameters"][i], data["parameters"][i]); }}o+="\r\n\t<\/div>\r\n\t"+ m.build("api_response", data, save_data) +"\r\n<\/section><script id=\""+ m.out(data.Template_id) +"_driver\">\r\n(function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\r\n\tvar display = driver.prev(); driver.remove();\r\n\tvar data = Template.data("+ m.out(data.Template_id) +");\r\n\t\r\n\t\/\/console.log(data);\r\n\tdisplay.on('click','.api_path_overlay,.api_path_header',function(){\r\n\t\tdisplay.toggleClass('open');\r\n\t});\r\n\t\r\n\tdisplay.on('remove',function (){\r\n\t\tdisplay.off();\r\n\t\tdelete driver;\r\n\t\tdelete display;\r\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\r\n\t});\r\n})(Template);\r\n<\/script>"; return o;},"api_response":function(data, save_data){ var o="<div class='api_response'>\r\n\t<h4 class='api_response_header'>Response<\/h4>\r\n<\/div><script id=\""+ m.out(data.Template_id) +"_driver\">\r\n(function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\r\n\tvar display = driver.prev(); driver.remove();\r\n\tvar data = Template.data("+ m.out(data.Template_id) +");\r\n\r\n\tdefinition=data.responses.default.schema.$ref||data.responses.default.schema.items.$ref||'appointment';\r\n\tdefinition=definition.split('\/').pop();\r\n\t\r\n\tlet properties =\r\n\t\twindow.swagger.definitions[definition].items&&window.swagger.definitions[definition].items.properties\r\n\t\t|| window.swagger.definitions[definition].properties\r\n\t\t|| window.swagger.definitions[definition].type;\r\n\t\r\n\t\r\n\t\/\/$('<pre>'+JSON.stringify(properties,null,\"\\t\")+'<\/pre>').appendTo(display);\r\n\tlet output='';\r\n\tif(typeof properties==='string'){\r\n\t\toutput=properties;\r\n\t}else{\r\n\t\tfor(var prop in properties){\r\n\t\t\toutput+=Template.build('api_response_property',{...properties[prop],'property':prop});\r\n\t\t}\r\n\t}\r\n\tdisplay.append(output);\r\n})(Template);\r\n<\/script>"; return o;},"api_response_property":function(data, save_data){ var o="<div class='api_response_property'>\r\n\t<div class='api_property'>\r\n\t\t<div class='api_property_header'><b>"+ m.out(data.property) +"<\/b> - <i>"+ m.out(data.type) +"<\/i><\/div>\r\n\t\t<div>"; if(data["description"]){if(!Array.isArray(data["description"])){data["description"]=[{"description":data["description"]}];}for(var i=0,l=(typeof data["description"]!=="string"?data["description"].length:1)||1;i<l;++i){ o+=m.build(function(data, save_data){ var o=""+ m.out(data.description) +""; return o;}, data["description"][i], data["description"][i]); }}o+="<\/div>\r\n\t<\/div>\r\n<\/div>"; return o;},"documentation_nav_item":function(data, save_data){ var o="<a href='#documentation_"+ m.out(data.operationId) +"' class='path_nav_header'>\r\n\t"+ m.out(data.path) +"\r\n<\/a><script id=\""+ m.out(data.Template_id) +"_driver\">\r\n(function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\r\n\tvar display = driver.prev(); driver.remove();\r\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\r\n\r\n\tdisplay.on('click', function(e){\r\n\t\te.preventDefault();\r\n\t\t$('#documentation_"+ m.out(data.operationId) +"').addClass('open');\r\n\t\t$('#documentation_"+ m.out(data.operationId) +"')[0].scrollIntoView({behavior: \"smooth\", block: \"start\", inline: \"nearest\"});\r\n\t\tif(top>0){\r\n\t\t\twindow.scrollTo(top,0);\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t});\r\n})(Template);\r\n<\/script>"; return o;},"example_customer_create":function(data, save_data){ var o="\r\n<h3>Create a customer (minimum)<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.call('customer','create',{\r\n\t'fname':'John',\r\n\t'lname':'Doe'\r\n}).then(console.log);\r\n<\/code>\r\n\r\n\r\n\r\n<h3>Create a customer (more parameters)<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.call('customer','create',{\r\n\t'fname':'John',\r\n\t'lname':'Doe'\r\n}).then(console.log);\r\n<\/code>\r\n\r\n\r\n\r\n<h3>Create and Update a customer<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.call('customer','create',{\r\n\t'fname':'John',\r\n\t'lname':'Doe'\r\n}).then(console.log);\r\n<\/code>\r\n\r\n\r\n<h3>Update <strike>all<\/strike> 50 customers with a balance older than 180 days and &gt;$9000 to inactive<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'balanceAge':{\r\n\t\t'operator':'&gt;',\r\n\t\t'value':'180'\r\n\t},\r\n\t'balance':{\r\n\t\t'operator':'&gt;',\r\n\t\t'value':'9000'\r\n\t},\r\n\t'status':1,\r\n\t'includeData':1\r\n},1).then(function(customers){\r\n\tcustomers=customers.slice(0,50); \/\/lets just do 50 since it's a demo...\r\n\t\r\n\tlet updates=[];\r\n\tfor(var i=0,l=customers.length;i&lt;l;++i){\r\n\t\tupdates.push({\r\n\t\t\t'customerID':customers[i]['customerID'],\r\n\t\t\t'status':0\r\n\t\t});\r\n\t}\r\n\t\r\n\treturn apiModule.staggeredWrite('customer','update',updates,8);\r\n}).then(console.log);\r\n<\/code>\r\n\r\n"; return o;},"example_document_upload":function(data, save_data){ var o="\r\n<h3>Upload a document<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<input class='upload_document_example_1' type='file'\/>\r\n<code class='example_code'>\r\n\/\/get the file into a string\r\nvar file = $('.upload_document_example_1')[0].files[0];\r\nvar reader = new FileReader();\r\nvar file_base_64;\r\nreader.readAsDataURL(file);\r\nreader.onload = function(){\r\n\tapiModule.call('document','createEncoded',{\r\n\t\t'customerID':58346,\r\n\t\t'description':'Contract from API',\r\n\t\t\/\/'filename':'contract_upload.jpg',\r\n\t\t'filename':file.name,\r\n\t\t'encodedFile': reader.result.split('base64,')[1] \/\/trim off the metadata\r\n\t}).then(console.log);\r\n};\r\nreader.onerror = function(error){\r\n\tconsole.error('Error: ', error);\r\n};\r\n<\/code>\r\n\r\n\r\n\r\n<h3>Upload a contract<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<input class='upload_document_example_2' type='file'\/>\r\n<code class='example_code'>\r\n\/\/get the file into a string\r\nvar file = $('.upload_document_example_2')[0].files[0];\r\nvar reader = new FileReader();\r\nvar file_base_64;\r\nreader.readAsDataURL(file);\r\nreader.onload = function(){\r\n\tapiModule.call('contract','create',{\r\n\t\t'subscriptionID':30353,\r\n\t\t'emailCustomer':0,\r\n\t\t'dateSigned':'2022-04-04',\r\n\t\t'base64EncodedFile': reader.result.split('base64,')[1] \/\/trim off the metadata\r\n\t}).then(console.log);\r\n};\r\nreader.onerror = function(error){\r\n\tconsole.error('Error: ', error);\r\n};\r\n<\/code>\r\n"; return o;},"example_load_key":function(data, save_data){ var o="\r\n<h3>Load a key into the apiModule<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.loadKeyset('demo',{\r\n\t\"base_url\":\"https:\/\/stagingdemo.pestroutes.com\/api\/\",\r\n\t\"keys\":[\"88492884d8154febd1057372867c2e34b371d8fb\"],\r\n\t\"tokens\":[\"6915e71f53708f17dba090febd2df4f9d79364d7\"],\r\n});\r\napiModule.setKeyset('demo)\r\n<\/code>\r\n\r\n<h3>Load a key into the apiModule and activate<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.loadKeyset('demo',{\r\n\t\"base_url\":\"https:\/\/stagingdemo.pestroutes.com\/api\/\",\r\n\t\"keys\":[\"88492884d8154febd1057372867c2e34b371d8fb\"],\r\n\t\"tokens\":[\"6915e71f53708f17dba090febd2df4f9d79364d7\"],\r\n},true);\r\n<\/code>\r\n\r\n<h3>Save a keyset locally<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.saveKeysetsLocally();\r\n<\/code>"; return o;},"example_old_examples":function(data, save_data){ var o="<h3>Get up to the minute documentation<\/h3>\r\n<section>\r\n\t<p>Get the raw swagger documenation export from our servers.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\n\r\napiModule.call('documentation','swagger',{});\r\n\/\/OR\r\n\/\/https:\/\/demo.pestroutes.com\/api\/documentation\/swagger?authenticationKey=88492884d8154febd1057372867c2e34b371d8fb&authenticationToken=6915e71f53708f17dba090febd2df4f9d79364d7\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n\r\n<h3>Load a keyset<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.loadKeyset('demo',{\r\n\t\"base_url\":\"https:\/\/stagingdemo.pestroutes.com\",\r\n\t\"keys\":[\"88492884d8154febd1057372867c2e34b371d8fb\"],\r\n\t\"tokens\":[\"6915e71f53708f17dba090febd2df4f9d79364d7\"],\r\n},1);\r\n\/\/apiModule.setKeyset('demo');\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n\r\n\r\n<h3>Send a bunch of subscription updates staggered (from csv)<\/h3>\r\n<section>\r\n\t<pre>\r\nsubscriptionID,officeID,duration\r\n10006,1,30\r\n10007,1,30\r\n\t<\/pre>\r\n\t<form id=\"csvForm\">\r\n\t\t<input type=\"file\" id=\"csvFile\" accept=\".csv\" \/>\r\n\t\t<input type=\"submit\" id=\"csvSubmit\" value=\"Submit csv updates\" style='display: none;'\/>\r\n\t<\/form>\r\n\t<h4>workflow<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nlet csvForm = document.getElementById(\"csvForm\");\r\nlet csvFile = document.getElementById(\"csvFile\");\r\n\r\ncsvForm.addEventListener(\"submit\", function(e){\r\n\te.preventDefault();\r\n\tlet input = csvFile.files[0];\r\n\tlet reader = new FileReader();\r\n\r\n\t\/\/Set the load action for the csv file\r\n\treader.onload = function(e){\r\n\t\tlet rows = apiModule.csvToArray(e.target.result);\r\n\t\t\/\/rows=rows.slice(0,1000);\r\n\t\t\/\/rows.unshift({\"subscriptionID\":18,\"officeID\":1,\"duration\":30});\r\n\t\treturn apiModule.staggeredWrite('subscription','update',rows,8)\r\n\t\t.then(function(r){\r\n\t\t\tconsole.log('bulk update results:');\r\n\t\t\tconsole.log(r);\r\n\t\t\tif(confirm('download result log?')){\r\n\t\t\t\tapiModule.downloadJSON(r);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\t\/\/load the csv file\r\n\treader.readAsText(input);\r\n});\r\n\r\nlet csvSubmit = document.getElementById(\"csvSubmit\");\r\ncsvSubmit.style.display = \"block\"\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>Send a bunch of updates staggered<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nreturn; \/\/delete me to run this crazy example\r\n\r\napiModule.search('subscription',{\r\n\t'includeData':1,\r\n\t'serviceID':1\r\n})\r\n.then(function(subscriptions){\r\n\tlet updates=[];\r\n\tfor(let i=0,l=subscriptions.length; i&lt;l;++i){\r\n\t\tupdates.push({\r\n\t\t\t\"subscriptionID\":subscriptions[i]['subscriptionID'],\r\n\t\t\t\"duration\":30,\r\n\t\t\t\"officeID\":subscriptions[i]['officeID']\r\n\t\t});\r\n\t}\r\n\treturn apiModule.staggeredWrite('subscription','update',updates,4);\r\n}).then(console.log);\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>Download all service types<\/h3>\r\n<section>\r\n\t<p>Download all service types with a global key.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('serviceType',{\r\n    \"officeIDs\":0, \/\/[-1, (officeIDs>0)]\r\n    \"includeData\":1\r\n},1).then(apiModule.download);\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Download all customerIDs<\/h3>\r\n<section>\r\n\t<p>Download all service types with a global key.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('customer',{\r\n    \"officeIDs\":{\"operator\":\">\",\"value\":\"0\"},\r\n},1).then(apiModule.download);\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Download all customers fully resolved<\/h3>\r\n<section>\r\n\t<p>Download all service types with a global key.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nreturn; \/\/safety\r\napiModule.search('customer',{\r\n    \"officeIDs\":{\"operator\":\">\",\"value\":\"0\"},\r\n    \"includeData\":1\r\n},1).then(apiModule.download);\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>test spot search<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('spot', {\r\n\t\"date\": {\r\n\t\t\"operator\":'IN',\r\n\t\t\"value\":[ \"2020-09-25\"],\r\n\t},\r\n\t\/\/\"routeIDs\": [78, 79, 80, 81, 82],\r\n\t\"apiCanSchedule\": 1,\r\n\t\"ignoreInitialDriveTime\":1,\r\n\t\"latitude\":  33.130489,\r\n\t\"longitude\": -96.651377,\r\n\t\"includeData\":1\r\n}).then(function(r){\r\n\t\/\/console.table(r, ['distanceToClosest','distanceToPrevious','distanceToNext','open','start','end']);\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Stress test spots pragmatic<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('spot', {\r\n\t\"date\": {\r\n\t\t\"operator\":\"BETWEEN\",\r\n\t\t\"value\":[\r\n\t\t\t\"2021-03-01\",\r\n\t\t\t\"2021-03-31\"\r\n\t\t]\r\n\t},\r\n\t\"routeIDs\":166,\r\n\t\"apiCanSchedule\": 1,\r\n\t\"latitude\":  33.130489,\r\n\t\"longitude\": -96.661377,\r\n\t\"includeData\":1,\r\n\t\/\/\"open\":1\r\n}).then(function(spots){\r\n\tfor(var i=0,l=spots.length;i&lt;l;++i){\r\n\t\tapiModule.get('spot',[spots[i]['spotID']]);\r\n\t}\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>Create a bunch of appointments for random customers<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nvar testRouteID=107;\r\n\r\napiModule.search('subscription',{\r\n\t'includeData':1,\r\n\t'status':1\r\n}).then(function(subscriptions){\r\n\tapiModule.shuffle(subscriptions);\r\n\tvar testSubscriptions=subscriptions.slice(0,10);\r\n\r\n\tfor(var i=0,l=testSubscriptions.length;i&lt;l;++i){\r\n\t\tlet start = Math.floor(Math.random() * 6) + 9; \/\/9am-3pm\r\n\t\tlet end = Math.floor(Math.random() * 4) + 2 + start; \/\/+2-6 hours later\r\n\r\n\t\t\/\/start=9;\r\n\t\t\/\/end=17;\r\n\t\tapiModule.call('appointment','create',{\r\n\t\t\t\"customerID\":     testSubscriptions[i]['customerID'],\r\n\t\t\t\"subscriptionID\": testSubscriptions[i]['subscriptionID'],\r\n\t\t\t\"type\":           testSubscriptions[i]['serviceID'],\r\n\t\t\t\"duration\":       Math.random()>.5?59:29,\r\n\t\t\t\"notes\":          'Api Created Appointment',\r\n\t\t\t\"spotID\":         0,\r\n\r\n\t\t\t'start':          (start<10?'0'+start:start)+':00:00',\r\n\t\t\t'end':            (end<10?'0'+end:end)+':00:00',\r\n\t\t\t'routeID':        testRouteID,\r\n\t\t\t\"employeeID\":     1\r\n\t\t});\r\n\t}\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>create a ticket with items<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.call('ticket', 'create',{\r\n\t\"customerID\":\t\t130,\r\n\t\"serviceID\":\t\t1,\r\n\r\n\t\"date\":\t\t\t\t\"2020-09-16\",\r\n\t\"billToAccountID\":\t0,\r\n\t\"serviceCharge\":\t69.96,\r\n\t\"additionalNotes\":\t'API TESTING',\r\n\t\"addons\":[\r\n\t\t{\r\n\t\t\t\"description\":\t'discount',\r\n\t\t\t\"quantity\":\t\t1,\r\n\t\t\t\"amount\":\t\t-1.99,\r\n\t\t\t\"productID\":\t0,\r\n\t\t\t\"serviceID\":\t0,\r\n\t\t\t\"taxable\":\t\t1,\r\n\t\t\t\"creditTo\":\t\t1,\r\n\t\t\t\"unitID\":\t\tnull\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"description\":\t'Addon item',\r\n\t\t\t\"quantity\":\t\t1,\r\n\t\t\t\"amount\":\t\t2.99,\r\n\t\t\t\"productID\":\t1,\r\n\t\t\t\"serviceID\":\t0,\r\n\t\t\t\"taxable\":\t\t1,\r\n\t\t\t\"creditTo\":\t\t1,\r\n\t\t\t\"unitID\":\t\tnull\r\n\t\t}\r\n\t]\r\n});\r\n\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Efficiently find the best route and spot for a location<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\n\r\nvar customerLatitude  ='33.13'+Math.ceil(Math.random()*100);\r\nvar customerLongitude='-96.66'+Math.ceil(Math.random()*100); \/\/'-83.86'\r\nvar dateFilter={\r\n\t'operator':'between',\r\n\t'value':['2020-09-24','2020-09-30']\r\n};\r\n\r\napiModule.search('route',{\r\n\t'date':dateFilter,\r\n\t'latitude':customerLatitude,\r\n\t'longitude':customerLongitude,\r\n\t\/\/'maxDistance':500,\r\n\t'apiCanSchedule':1,\r\n\t'includeData':1\r\n}).then(function(routes){\r\n\t\/\/Sort by averageDistance ASC\r\n\troutes.sort(function(a, b){\r\n\t\t\/\/empty routes to the bottom\r\n\t\tif(a.averageDistance===b.averageDistance){\r\n\t\t\treturn 0;\r\n\t\t}else if(a.averageDistance===null){\r\n\t\t\treturn 1;\r\n\t\t}else if(b.averageDistance===null){\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn (parseFloat(a.averageDistance) > parseFloat(b.averageDistance)) ? 1 : -1;\r\n\t});\r\n\r\n\tconsole.log(routes.map( r=>r.averageDistance) );\r\n\r\n\t\/\/Take only the first 10 routeIDs\r\n\tvar routeIDs = routes.splice(0,10).map( r => r.routeID );\r\n\r\n\treturn apiModule.search('spot',{\r\n\t\t'routeIDs':routeIDs,\r\n\t\t'date':dateFilter,\r\n\t\t'latitude':customerLatitude,\r\n\t\t'longitude':customerLongitude,\r\n\t\t'apiCanSchedule':1,\r\n\t\t'ignoreInitialDriveTime':1, \/\/ with this filter once a route has any appointment on it the start and end location of the technician will no longer be considered\r\n\t\t'includeData':1\r\n\t}).then(function(spots){\r\n\t\tfor(let i=0,l=spots.length;i&lt;l;++i){\r\n\r\n\t\t\t\/\/**if you need to accomodate appointments longer than the capacity of a spot more logic is necessary!\r\n\t\t\tif(spots[i].open&spots[i].apiCanSchedule){\r\n\t\t\t\treturn spots[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t\/\/fallback: search the remaining routes\r\n\t\treturn apiModule.search('spot',{\r\n\t\t\t'routeIDs':routes.map( r => r.routeID ),\r\n\t\t\t'date':dateFilter,\r\n\t\t\t'latitude':customerLatitude,\r\n\t\t\t'longitude':customerLongitude,\r\n\t\t\t'apiCanSchedule':1,\r\n\t\t\t'ignoreInitialDriveTime':1,\r\n\t\t\t'includeData':1\r\n\t\t}).then(function(spots){\r\n\t\t\tfor(let i=0,l=spots.length;i&lt;l;++i){\r\n\t\t\t\tif(spots[i].open&spots[i].apiCanSchedule){\r\n\t\t\t\t\treturn spots[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn 'could not find spot!';\r\n\t\t});\r\n\t});\r\n}).then(console.log);\r\n\r\n\r\n\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>create a payment profile for a random customer with element<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('customer',{\r\n\t'includeData':1\r\n}).then(function(customers){\r\n\tapiModule.call('customer', 'createPaymentProfile', {\r\n\t\t'customerID': customers[0]['customerID'],\r\n\t\t'billingAddress1': customers[0]['address'],\r\n\t\t'billingCity': customers[0]['city'],\r\n\t\t'billingState': customers[0]['state'],\r\n\t\t'billingZip': customers[0]['zip'],\r\n\t\t'billingCountryID':'US',\r\n\r\n\t\t\"CreditCardToken\":'F33F5BB8-142A-4AC8-BD39-1CD523C7A059',\r\n\t\t\/\/\"CreditCardTokenID\":\"144531766\", \/\/NMI customer_vault_id can send repeatedly\r\n\t});\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n\r\n\r\n\r\n<h3>Get all customers that prefer paper<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('customerFlag',{\r\n\t'customerFlags':'prefersPaper',\r\n\t'includeData':1\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Scheduling an appointment to an ideal spot<\/h3>\r\n<section>\r\n\t<p>This workflow will create a customer (with a subscription and a payment profile) if it doesn't already exist, schedule an appointment if it's needed, then charge the customer through PestRoutes.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nvar data={};\r\napiModule.search('customer',{\r\n\t'customerIDs':20303,\r\n\t'includeData':1\r\n}).then(function( customers ){\r\n\tdata.customer=customers[0];\r\n\tdata.subscriptionIDs=data.customer.subscriptionIDs.split(',');\r\n\tlet latestSubscriptionID=data.subscriptionIDs[data.subscriptionIDs.length-1];\r\n\t\r\n\t\/\/retrieve the subscription\r\n\treturn apiModule.get('subscription',[latestSubscriptionID]);\r\n}).then(function( subscriptions ){\r\n\tdata.subscription=subscriptions[0];\r\n\r\n\t\/\/Check for pending appointments\r\n\treturn apiModule.search('appointment',{\r\n\t\t'subscriptionIDs': data.subscription['subscriptionID'],\r\n\t\t'status':0\r\n\t});\r\n}).then(function( appointments ){\r\n\r\n\t\/\/Bail out if there is already a pending appointment\r\n\tif(false&&appointments.length>0){\r\n\t\treturn Promise.reject('Pending appointment exists!');\r\n\t}\r\n\r\n\t\/\/Get the spots for next Monday or Tuesday\r\n\treturn apiModule.search('spot', {\r\n\t\t\"date\": {\r\n\t\t\t\"operator\":\"BETWEEN\",\r\n\t\t\t\"value\":[\r\n\t\t\t\t\"2020-08-03\",\r\n\t\t\t\t\"2020-08-04\"\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"apiCanSchedule\": 1,\r\n\t\t\"latitude\":  data.customer.lat, \/\/33.130489,\r\n\t\t\"longitude\": data.customer.lng, \/\/-96.661377,\r\n\t\t\"includeData\":1\r\n\t});\r\n}).then(function( spots ){\r\n\t\r\n\t\/\/console.table(spots);\r\n\t\/\/The spots come back ordered by the distance from the tech's previous location (last customer, employee endpoint, or office location), the first open spot should be fine\r\n\tlet chosenSpot=false;\r\n\tfor( var i=0, l=spots.length; i&lt;l; ++i){\r\n\t\tif(spots[i]['open']==1){\r\n\t\t\tchosenSpot=spots[i];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t\/\/Note that if the duration of the appointment is greater than 'spotCapacity' nextSpotID should be checked for openness until full duration is accomodated\r\n\r\n\treturn chosenSpot;\r\n}).then(function( spot ){\r\n\r\n\t\/\/create the appointment\r\n\treturn apiModule.call('appointment','create',{\r\n\t\t\"customerID\":     data.customer['customerID'],\r\n\t\t\"type\":           data.subscription['serviceID'],\r\n\t\t\"duration\":       29,\r\n\t\t\"notes\":          'Api Created Appointment',\r\n\t\t\"spotID\":         spot['spotID'],\r\n\t\t\"subscriptionID\": data.subscription['subscriptionID'],\r\n\t\t\"employeeID\":     1\r\n\t});\r\n}).then(function( createResult ){\r\n\tlet appointmentID = createResult['success']==true? createResult['result'] : false;\r\n\r\n\tif(appointmentID===false){\r\n\t\treturn Promise.reject('Failed to create appointment!');\r\n\t}\r\n\r\n\treturn Promise.resolve('Appointment created!');\r\n\r\n}).then(console.log, console.error);\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Scheduling and rescheduling an appointment for a known customer.<\/h3>\r\n<section>\r\n\t<p>This workflow will find an ideal spot for a customer, then reschedule that customer.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nvar data={};\r\napiModule.search('customer',{\r\n\t'customerIDs':20303,\r\n\t'includeData':1\r\n}).then(function( customers ){\r\n\tdata.customer=customers[0];\r\n\tdata.subscriptionIDs=data.customer.subscriptionIDs.split(',');\r\n\tlet latestSubscriptionID=data.subscriptionIDs[data.subscriptionIDs.length-1];\r\n\t\r\n\t\/\/retrieve the subscription\r\n\treturn apiModule.get('subscription',[latestSubscriptionID]);\r\n}).then(function( subscriptions ){\r\n\tdata.subscription=subscriptions[0];\r\n\r\n}).then(function( appointments ){\r\n\r\n\t\/\/Get the spots for next Monday or Tuesday\r\n\treturn apiModule.search('spot', {\r\n\t\t\"date\": {\r\n\t\t\t\"operator\":\"BETWEEN\",\r\n\t\t\t\"value\":[\r\n\t\t\t\t\"2020-07-20\",\r\n\t\t\t\t\"2020-07-21\"\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"apiCanSchedule\": 1,\r\n\t\t\"latitude\":  data.customer.lat, \/\/33.130489,\r\n\t\t\"longitude\": data.customer.lng, \/\/-96.661377,\r\n\t\t\"includeData\":1\r\n\t});\r\n}).then(function( spots ){\r\n\t\/\/console.table(spots);\r\n\t\/\/The spots come back ordered by the distance from the tech's previous location (last customer, employee endpoint, or office location), the first open spot should be fine\r\n\tlet chosenSpot=false;\r\n\tfor( var i=0, l=spots.length; i&lt;l; ++i){\r\n\t\tif(spots[i]['open']==1){\r\n\t\t\tchosenSpot=spots[i];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t\/\/Note that if the duration of the appointment is greater than 'spotCapacity' nextSpotID should be checked for openness until full duration is accomodated\r\n\r\n\treturn chosenSpot;\r\n}).then(function( spot ){\r\n\r\n\t\/\/create the appointment\r\n\treturn apiModule.call('appointment','create',{\r\n\t\t\"customerID\":     data.customer['customerID'],\r\n\t\t\"type\":           data.subscription['serviceID'],\r\n\t\t\"duration\":       14,\r\n\t\t\"notes\":          'Api Created Appointment',\r\n\t\t\"spotID\":         spot['spotID'],\r\n\t\t\"subscriptionID\": data.subscription['subscriptionID']\r\n\t});\r\n}).then(function( createResult ){\r\n\tdata.appointmentID = createResult['success']==true? createResult['result'] : false;\r\n\r\n\t\/\/Get the new spot for WED\/THUR\r\n\treturn apiModule.search('spot', {\r\n\t\t\"date\": {\r\n\t\t\t\"operator\":\"BETWEEN\",\r\n\t\t\t\"value\":[\r\n\t\t\t\t\"2020-07-22\",\r\n\t\t\t\t\"2020-07-23\"\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"apiCanSchedule\": 1,\r\n\t\t\"latitude\":  data.customer.lat, \/\/33.130489,\r\n\t\t\"longitude\": data.customer.lng, \/\/-96.661377,\r\n\t\t\"includeData\":1\r\n\t});\r\n}).then(function( spots ){\r\n\t\/\/console.table(spots);\r\n\t\/\/The spots come back ordered by the distance from the tech's previous location (last customer, employee endpoint, or office location), the first open spot should be fine\r\n\tlet chosenSpot=false;\r\n\tfor( var i=0, l=spots.length; i&lt;l; ++i){\r\n\t\tif(spots[i]['open']==1){\r\n\t\t\tchosenSpot=spots[i];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t\/\/Note that if the duration of the appointment is greater than 'spotCapacity' nextSpotID should be checked for openness until full duration is accomodated\r\n\r\n\treturn chosenSpot;\r\n}).then(function( spot ){\r\n\tif(data.appointmentID===false){\r\n\t\treturn Promise.reject('Failed to update appointment!');\r\n\t}\r\n\r\n\treturn apiModule.call('appointment','update',{\r\n\t\t'appointmentID':  data.appointmentID,\r\n\t\t\"customerID\":     data.customer['customerID'],\r\n\t\t\"type\":           data.subscription['serviceID'],\r\n\t\t\"duration\":       14,\r\n\t\t\"notes\":          'Api UPDATED Appointment',\r\n\t\t\"spotID\":         spot['spotID'],\r\n\t\t\"subscriptionID\": data.subscription['subscriptionID']\r\n\t});\r\n\r\n})\r\n.then(console.log, console.error);\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>Updating a customer via import\/main safely<\/h3>\r\n<section>\r\n\t<p>First, read the current state of the customer from the customer\/get endpoint then maps those values to the import\/main field names, modifies reminder preferences to off, then sends to import\/main for update.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.selectCustomersForUpdate([20301])\r\n.then(function(customers){\r\n\r\n\t\/\/Turn off reminders for the customer\r\n\tcustomers[0]['PhoneReminders']=0;\r\n\tcustomers[0]['SmsReminders']=0;\r\n\tcustomers[0]['EmailReminders']=0;\r\n\r\n\t\/\/Write the customer\r\n\treturn apiModule.call('import','main',{\r\n\t\t\"dataMain\": customers\r\n\t});\r\n})\r\n.then(console.log);\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Sync all products<\/h3>\r\n<section>\r\n\t<p><\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nvar products = [\r\n\t{\r\n\t\t\"productID\": \"1\",\r\n\t\t\"officeID\": \"1\",\r\n\t\t\"description\": \"WE CHANGED THIS DESCRIPTION\",\r\n\t\t\"amount\": \"-50.00\",\r\n\t\t\"taxable\": \"1\",\r\n\t\t\"code\": \"COUPON \",\r\n\t\t\"category\": \"COUPONS\",\r\n\t\t\"visible\": \"1\",\r\n\t\t\"salesVisible\": \"1\",\r\n\t\t\"recurring\": \"0\"\r\n\t},\r\n\t{\r\n\t\t\"productID\": \"2\",\r\n\t\t\"officeID\": \"1\",\r\n\t\t\"description\": \"Cancellation Fee\",\r\n\t\t\"amount\": \"100.00\",\r\n\t\t\"taxable\": \"0\",\r\n\t\t\"code\": \"EFT\",\r\n\t\t\"category\": \"ADMIN\",\r\n\t\t\"visible\": \"1\",\r\n\t\t\"salesVisible\": \"1\",\r\n\t\t\"recurring\": \"0\"\r\n\t},\r\n\t{\r\n\t\t\"productID\": \"6\",\r\n\t\t\"officeID\": \"1\",\r\n\t\t\"description\": \"MOTH FOG\",\r\n\t\t\"amount\": \"25.00\",\r\n\t\t\"taxable\": \"1\",\r\n\t\t\"code\": \"MOTH\",\r\n\t\t\"category\": \"MOTH\",\r\n\t\t\"visible\": \"1\",\r\n\t\t\"salesVisible\": \"1\",\r\n\t\t\"recurring\": \"1\"\r\n\t},\r\n\t{\r\n\t\t\"productID\": \"8\",\r\n\t\t\"officeID\": \"1\",\r\n\t\t\"description\": \"Candy Party\",\r\n\t\t\"amount\": \"5000.00\",\r\n\t\t\"taxable\": \"1\",\r\n\t\t\"code\": \"CANDY\",\r\n\t\t\"category\": \"PARTY\",\r\n\t\t\"visible\": \"1\",\r\n\t\t\"salesVisible\": \"1\",\r\n\t\t\"recurring\": \"0\"\r\n\t},\r\n\t{\r\n\t\t\"productID\": false,\r\n\t\t\"officeID\": \"-1\",\r\n\t\t\"description\": \"This is a new one\",\r\n\t\t\"amount\": \"100.00\",\r\n\t\t\"taxable\": \"1\",\r\n\t\t\"code\": \"MASTER\",\r\n\t\t\"category\": \"RO\",\r\n\t\t\"visible\": \"1\",\r\n\t\t\"salesVisible\": \"1\",\r\n\t\t\"recurring\": \"0\"\r\n\t},\r\n\t{\r\n\t\t\"productID\": false,\r\n\t\t\"officeID\": \"-1\",\r\n\t\t\"description\": \"This is another new one\",\r\n\t\t\"amount\": \"101.00\",\r\n\t\t\"taxable\": \"1\",\r\n\t\t\"code\": \"DOCTOR\",\r\n\t\t\"category\": \"DR\",\r\n\t\t\"visible\": \"1\",\r\n\t\t\"salesVisible\": \"1\",\r\n\t\t\"recurring\": \"0\"\r\n\t}\r\n];\r\n\r\n\/\/get all PR product IDs\r\napiModule.search('product',{})\r\n.then(function(productIDs){\r\n\t\/\/Resolve productIDs to entities in groups of 1000\r\n\treturn apiModule.staggeredRequest('product', productIDs);\r\n})\r\n.then(function(prProducts){\r\n\t\r\n\t\/\/Index remote products on code field\r\n\tvar indexedProducts = {};\r\n\tfor(var i=0,l=prProducts.length; i&lt;l; ++i){\r\n\t\tif(prProducts[i]['code']==''){ \/\/Warn on entries with no code\r\n\t\t\tconsole.error('product missing code', prProducts[i]);\r\n\t\t} else if(typeof indexedProducts[ prProducts[i]['code'] ] !== 'undefined'){ \/\/Warn on duplicates\r\n\t\t\tconsole.error('Duplicate product code: ' + prProducts[i]['code'], prProducts[i]);\r\n\t\t} else {\r\n\t\t\tindexedProducts[ prProducts[i]['code'] ]=prProducts[i];\r\n\t\t}\r\n\t}\r\n\r\n\tvar creates = [];\r\n\tvar updates = [];\r\n\t\/\/compare local list against remote list\r\n\tfor(var i=0,l=products.length; i&lt;l; ++i){\r\n\t\tif( typeof indexedProducts[ products[i]['code'] ] === 'undefined'\r\n\t\t\t&& indexedProducts[ products[i]['code'] ] != ''\r\n\t\t){\r\n\t\t\tcreates.push(products[i]);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tlet remote = indexedProducts[products[i]['code']];\r\n\t\tif(\r\n\t\t\t   products[i]['description']!=  remote['description']\r\n\t\t\t|| products[i]['amount']!=       remote['amount']\r\n\t\t\t|| products[i]['taxable']!=      remote['taxable']\r\n\t\t\t|| products[i]['category']!=     remote['category']\r\n\t\t\t|| products[i]['visible']!=      remote['visible']\r\n\t\t\t|| products[i]['salesVisible']!= remote['salesVisible']\r\n\t\t\t|| products[i]['recurring']!=    remote['recurring']\r\n\t\t){\r\n\t\t\tupdates.push({\r\n\t\t\t\t'productID': remote['productID'],\r\n\t\t\t\t'description': products[i]['description'],\r\n\t\t\t\t'amount': products[i]['amount'],\r\n\t\t\t\t'taxable': products[i]['taxable'],\r\n\t\t\t\t'category': products[i]['category'],\r\n\t\t\t\t'visible': products[i]['visible'],\r\n\t\t\t\t'salesVisible': products[i]['salesVisible'],\r\n\t\t\t\t'recurring': products[i]['recurring']\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction createProducts(newProducts){\r\n\t\tvar currentProduct = newProducts.shift();\r\n\t\tapiModule.call('product','create',{\r\n\t\t\t\"officeID\":      currentProduct['officeID'],\r\n\t\t\t\"description\":   currentProduct['description'],\r\n\t\t\t\"amount\":        currentProduct['amount'],\r\n\t\t\t\"taxable\":       currentProduct['taxable'],\r\n\t\t\t\"code\":          currentProduct['code'],\r\n\t\t\t\"category\":      currentProduct['category'],\r\n\t\t\t\"visible\":       currentProduct['visible'],\r\n\t\t\t\"salesVisible\":  currentProduct['salesVisible'],\r\n\t\t\t\"recurring\":     currentProduct['recurring']\r\n\t\t}).then(function(response){\r\n\t\t\t\/\/Save created productID if you want\r\n\t\t\tconsole.log(response.result);\r\n\r\n\t\t\t\/\/Recurse while not empty\r\n\t\t\tif(newProducts.length>0){\r\n\t\t\t\tcreateProducts(newProducts);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\t\/\/Do the create calls\r\n\tif(creates.length>0){\r\n\t\tcreateProducts(creates);\r\n\t}\r\n\r\n\r\n\tfunction updateProducts(changedProducts){\r\n\t\tvar currentProduct = changedProducts.shift();\r\n\t\tapiModule.call('product','update',currentProduct)\r\n\t\t.then(function(response){\r\n\t\t\t\/\/Recurse while not empty\r\n\t\t\tif(changedProducts.length>0){\r\n\t\t\t\tupdateProducts(changedProducts);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\t\/\/Do the update calls\r\n\tif(updates.length>0){\r\n\t\tupdateProducts(updates);\r\n\t}\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<section>\r\n\t<p>Ping for reachability every 5 minutes<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\nfunction sleep(ms){ return new Promise(resolve => setTimeout(resolve, ms)); }\r\nasync function applesauce(){ await sleep(5*60*1000); return apiModule.search('customer',{}).then(function(r){ alert('success!');console.log(r); }, applesauce); } applesauce();\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h3>Big Workflow<\/h3>\r\n<section>\r\n\t<p>This workflow will create a customer (with a subscription and a payment profile) if it doesn't already exist, schedule an appointment if it's needed, then charge the customer through PestRoutes.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\n\r\n\/\/Build our test data\r\nvar data = {};\r\nvar sampleCustomer={\r\n\t\/\/Customer Infomation\r\n\t\"CustomerID\":      \"CleanTest0020\",     \/\/Your primary key, iterate to repeat test\r\n\t\"Branch\":          \"Demo Pest Control\", \r\n\t\"CustomerName\":    \"Liberty Burger\",\r\n\t\"CustomerAddress\": \"824 W Stacy Rd\",\r\n\t\"CustomerCity\":    \"Allen\",\r\n\t\"CustomerState\":   \"TX\",\r\n\t\"CustomerZipCode\": \"75013\",\r\n\t\"CustomerPhone1\":  \"1118675309\",\r\n\t\"CustomerPhone2\":  \"5558675309\",\r\n\t\"CustomerEmail\":    \"\",\r\n\t\"CustomerStatus\":   \"Act\",\r\n\r\n\t\/\/NMI token\r\n\t\/\/\"CreditCardToken\":\"n43k4enf-mcJEHj-4BG9WJ-EggA4286Qf27\", \/\/These are one-time use! We convert it to a customer_vault_id and store\r\n\t\/\/\"CreditCardTokenID\":\"144531766\", \/\/NMI customer_vault_id can send repeatedly\r\n\r\n\t\/\/Element\r\n\t\/\/\"CreditCardToken\":'F33F5BB8-142A-4AC8-BD39-1CD523C7A059',\r\n\r\n\t\/\/Braintree\r\n\t\/\/\"CreditCardTokenID\":'7qf8yk',\r\n\t\/\/\"CreditCardToken\":'506160933',\r\n\r\n\r\n\t\/\/Subscription information - Will always CREATE a subscription if set\r\n\t\"Frequency\": 90, \t\t\t\t\/\/These three fields\r\n\t\"ServiceType\": 'API Quarterly', \/\/ are the minimum to\r\n\t\"Price\": '200',\t\t\t\t\t\/\/ create a subscription\r\n\r\n\r\n\t\/\/\"Lead\": 'No',\t\t\t\t\t\/\/Set Yes to create subscription as a LEAD\r\n\t\/\/\"LastService\": '4\/26\/18',\t\t\/\/ If this is set it will override Lead to No\r\n\t\/\/\"InitialService\": '1\/26\/18',\t\/\/ If this is set it will override Lead to No\r\n};\r\n\r\n\/\/First, let's see if the customer exists based on our external primary key\r\napiModule.search('customer',{\r\n\t'customerLink':sampleCustomer['CustomerID'],\r\n\t'includeData':1\r\n}).then(function( customers ){\r\n\t\r\n\t\/\/Return true if the customer exists\r\n\tif( customers.length>0 ){\r\n\t\tdata.customer=customers[0];\r\n\t\tdata.subscriptionIDs=data.customer.subscriptionIDs.split(',');\r\n\t\treturn Promise.resolve(true);\r\n\t}\r\n\r\n\t\/\/create the customer if it doesn't exist\r\n\treturn apiModule.call('import','main',{\r\n\t\t\"dataMain\":[sampleCustomer]\r\n\t});\r\n}).then(function( importResult ){\r\n\r\n\t\/\/We can skip this step; the customer was found in step 1\r\n\tif( importResult===true ){\r\n\t\treturn Promise.resolve(true);\r\n\t}\r\n\r\n\t\/\/Detect import error\r\n\tif(\r\n\t\timportResult['success']==0\r\n\t\t|| importResult['customersImported'].length==0\r\n\t){\r\n\t\talert('failed to import customer');\r\n\t}\r\n\r\n\tlet customerID = importResult['customersImported'][0]['PestRoutesCustomerID'];\r\n\r\n\t\/\/retrieve the customer (includes nested subscriptionIDs)\r\n\treturn apiModule.get('customer',[customerID]);\r\n}).then(function( customers ){\r\n\r\n\t\/\/store the new data if we did the create operation\r\n\tif( customers!==true ){\r\n\t\tdata.customer=customers[0];\r\n\t\tdata.subscriptionIDs=data.customer.subscriptionIDs.split(',');\r\n\t}\r\n\r\n\tlet latestSubscriptionID=data.subscriptionIDs[data.subscriptionIDs.length-1];\r\n\t\r\n\t\/\/retrieve the subscription\r\n\treturn apiModule.get('subscription',[latestSubscriptionID]);\r\n}).then(function( subscriptions ){\r\n\r\n\tdata.subscription=subscriptions[0];\r\n\r\n\t\/\/check if the subscription is due for service\r\n\tlet currentDate = (new Date()).toISOString().substring(0,10);\r\n\tlet serviceDue = data.subscription['nextService']<=currentDate;\r\n\r\n\tif(!serviceDue){\r\n\t\treturn Promise.reject('Service is not due for the subscription!');\r\n\t}\r\n\r\n\r\n\r\n\t\/\/create a paymentProfile\r\n\treturn apiModule.call('customer', 'createPaymentProfile', {\r\n\t\t'customerID': data.customer['customerID'],\r\n\t\t'billingAddress1': data.customer['address'],\r\n\t\t'billingCity': data.customer['city'],\r\n\t\t'billingState': data.customer['state'],\r\n\t\t'billingZip': data.customer['zip'],\r\n\t\t'billingCountryID':'US',\r\n\t\t\r\n\t\t\"CreditCardToken\":\"n43k4enf-mcJEHj-4BG9WJ-EggA4286Qf27\", \/\/These are one-time use! We convert it to a customer_vault_id and store\r\n\t\t\/\/\"CreditCardTokenID\":\"144531766\", \/\/NMI customer_vault_id can send repeatedly\r\n\t});\r\n}).then(function( paymentProfileCreated ){\r\n\r\n\t\/\/Get customer to check the customer last4 etc...\r\n\treturn apiModule.get('customer',[ data.customer['customerID'] ]);\r\n}).then(function( customers ){\r\n\tdata.customer=customers[0];\r\n\tconsole.log(data.customer);\r\n\r\n\r\n\t\/\/check if there is alredy a pending appointment for that subscription\r\n\treturn apiModule.search('appointment',{\r\n\t\t'subscriptionIDs': data.subscription['subscriptionID'],\r\n\t\t'status':0\r\n\t});\r\n}).then(function( appointments ){\r\n\r\n\t\/\/Bail out if there is already a pending appointment\r\n\tif(appointments.length>0){\r\n\t\treturn Promise.reject('Pending appointment exists!');\r\n\t}\r\n\r\n\t\/\/Get the spots for next Monday or Tuesday\r\n\treturn apiModule.search('spot', {\r\n\t\t\"date\": {\r\n\t\t\t\"operator\":\"BETWEEN\",\r\n\t\t\t\"value\":[\r\n\t\t\t\t\"2019-10-08\",\r\n\t\t\t\t\"2019-10-09\"\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"apiCanSchedule\": 1,\r\n\t\t\"latitude\":  33.130489,\r\n\t\t\"longitude\":-96.661377,\r\n\t\t\"includeData\":1\r\n\t});\r\n}).then(function( spots ){\r\n\t\r\n\t\/\/console.table(spots);\r\n\t\/\/The spots come back ordered by the distance from the tech's previous location (last customer, employee endpoint, or office location) , the first open spot should be fine\r\n\tlet chosenSpot=false;\r\n\tfor( var i=0, l=spots.length; i&lt;l; ++i){\r\n\t\tif(spots[i]['open']==1){\r\n\t\t\tchosenSpot=spots[i];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t\/\/Note that if the duration of the appointment is greater than 'spotCapacity' nextSpotID should be checked for openness until full duration is accomodated\r\n\r\n\treturn chosenSpot;\r\n}).then(function( spot ){\r\n\r\n\t\/\/create the appointment\r\n\treturn apiModule.call('appointment','create',{\r\n\t\t\"customerID\":     data.customer['customerID'],\r\n\t\t\"type\":           data.subscription['serviceID'],\r\n\t\t\"duration\":       14,\r\n\t\t\"notes\":          'Api Created Appointment',\r\n\t\t\"spotID\":         spot['spotID'],\r\n\t\t\"subscriptionID\": data.subscription['subscriptionID']\r\n\t});\r\n}).then(function( createResult ){\r\n\tlet appointmentID = createResult['success']==true? createResult['result'] : false;\r\n\r\n\tif(appointmentID===false){\r\n\t\treturn Promise.reject('Failed to create appointment!');\r\n\t}\r\n\r\n\t\/\/create a payment for the customer, charge the card on file\r\n\treturn apiModule.call('payment','create',{\r\n\t\t\"customerID\":data.customer['customerID'],\r\n\t\t\"amount\": 100,\r\n\t\t\"notes\":'API generated payment',\r\n\t\t\"paymentMethod\":3, \/\/ 0-Coupon, 1-Cash, 2-Check, 3-Credit Card, 4 ACH\r\n\t\t\r\n\t\t\/\/Optionally charge the card\/ACH on file through PestRoutes\r\n\t\t'doCharge': 1,\r\n\r\n\t\t\/\/Optionally limit the payment to the subscription\r\n\t\t'subscriptionID':data.subscription['subscriptionID']\r\n\t});\r\n}).then(function( paymentResult ){\r\n\r\n\tif(paymentResult['success']==true){\r\n\t\treturn Promise.resolve('Payment Created');\r\n\t}else{\r\n\t\treturn Promise.reject(paymentResult['errorMessage']);\r\n\t}\r\n\r\n}).then(console.log, console.error);\r\n\r\n\t<\/code>\r\n<\/section>\r\n\r\n<h2 style='margin-top:10em;'>Generic examples follow<\/h2>\r\n<hr>\r\n\r\n\r\n\r\n\r\n<h3>Create a customer<\/h3>\r\n<section>\r\n\t<p>To create a customer use the import\/main endpoint. Subsequent requests with the same 'CustomerID' property will perform a set operation, updating the matched entity to the data sent. Here we'll use 'PestRoutesTesting1234'. This is a fantasy, so we'll be servicing Disney World in this demo.\r\n\r\n\tFull list of import\/main parameters here: https:\/\/pestroutes.api-docs.io\/3.1\/import\/importmainobject<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.call('import','main',{\r\n\t\"dataMain\":[\r\n\t\t{\r\n\t\t\t\"CustomerID\": \"PestRoutesTesting1234\",\r\n\t\t\t\"Branch\": \"Demo Pest Control\",\r\n\t\t\t\"CustomerName\": \"PestRoutes Testing01\",\r\n\t\t\t\"CustomerAddress\": \"Walt Disney World Resort, Orlando, FL 32830\",\r\n\t\t\t\"CustomerCity\": \"Orlando\",\r\n\t\t\t\"CustomerState\": \"FL\",\r\n\t\t\t\"CustomerZipCode\": \"32830\",\r\n\t\t\t\"CustomerPhone1\": \"4428675309\",\r\n\t\t\t\"CustomerPhone2\": \"4438675309\",\r\n\t\t\t\"CustomerEmail\": \"\",\r\n\t\t\t\"CustomerStatus\": \"Act\"\r\n\r\n\t\t\t\/\/\"Frequency\": 90, \t\t\t\t\/\/These three fields\r\n\t\t\t\/\/\"ServiceType\": 'Quarterly',\t\/\/ are the minimum to\r\n\t\t\t\/\/\"Price\": '111',\t\t\t\t\/\/ create a subscription\r\n\r\n\t\t\t\/\/\"Lead\": 'No',\t\t\t\t\t\/\/Set Yes to revert subscription to a LEAD\r\n\t\t\t\/\/\"LastService\": '4\/26\/18',\t\t\/\/ If this is set it will override Lead to No\r\n\t\t\t\/\/\"InitialService\": '1\/26\/18',\t\/\/ If this is set it will override Lead to No\r\n\t\t}\r\n\t]\r\n});\r\n\t<\/code>\r\n\r\n\t<h4>JQuery<\/h4>\r\n\t<code class='closed'>\r\n$.post(\"https:\/\/demo.pestroutes.com\/api\/import\/main\",\r\n{\r\n\t\"authenticationKey\": \"xxx\",\r\n\t\"authenticationToken\": \"xxx\",\r\n\t\"dataMain\":[\r\n\t\t{\r\n\t\t\t\"CustomerID\": \"PestRoutesTesting1234\",\r\n\t\t\t\"Branch\": \"Demo Pest Control\",\r\n\t\t\t\"CustomerName\": \"PestRoutes Testing01\",\r\n\t\t\t\"CustomerAddress\": \"Walt Disney World Resort, Orlando, FL 32830\",\r\n\t\t\t\"CustomerCity\": \"Orlando\",\r\n\t\t\t\"CustomerState\": \"FL\",\r\n\t\t\t\"CustomerZipCode\": \"32830\",\r\n\t\t\t\"CustomerPhone1\": \"4428675309\",\r\n\t\t\t\"CustomerPhone2\": \"4438675309\",\r\n\t\t\t\"CustomerEmail\": \"\",\r\n\t\t\t\"CustomerStatus\": \"Act\"\r\n\t\t}\r\n\t]\r\n}, function(response){\r\n\tconsole.log(response);\r\n},\"JSON\");\r\n\t<\/code>\r\n\r\n\t<h4>CURL<\/h4>\r\n\t<code class='closed'>\r\ncurl 'https:\/\/demo.pestroutes.com\/api\/import\/main' -H 'Accept: application\/json, text\/javascript, *\/*; q=0.01'-H 'Sec-Fetch-Mode: cors' -H 'Content-Type: application\/x-www-form-urlencoded; charset=UTF-8' --data 'dataMain%5B0%5D%5BCustomerID%5D=PestRoutesTesting1234&dataMain%5B0%5D%5BBranch%5D=Demo+Pest+Control&dataMain%5B0%5D%5BCustomerName%5D=PestRoutes+Testing01&dataMain%5B0%5D%5BCustomerAddress%5D=Walt+Disney+World+Resort%2C+Orlando%2C+FL+32830&dataMain%5B0%5D%5BCustomerCity%5D=Orlando&dataMain%5B0%5D%5BCustomerState%5D=FL&dataMain%5B0%5D%5BCustomerZipCode%5D=32830&dataMain%5B0%5D%5BCustomerPhone1%5D=4428675309&dataMain%5B0%5D%5BCustomerPhone2%5D=4438675309&dataMain%5B0%5D%5BCustomerEmail%5D=&dataMain%5B0%5D%5BCustomerStatus%5D=INA&authenticationKey=xxx&authenticationToken=xxx' --compressed\r\n\t<\/code>\r\n\r\n\t<h4>Result<\/h4>\r\n\t<code class='closed'>\r\n{\r\n\t\"params\": {\r\n\t\t\"endpoint\": \"import\",\r\n\t\t\"action\": \"main\",\r\n\t\t\"dataMain\": [],\r\n\t\t\"authenticationKey\": \"xxx\",\r\n\t\t\"authenticationToken\": \"xxx\"\r\n\t},\r\n\t\"requestAction\": \"main\",\r\n\t\"endpoint\": \"import\",\r\n\t\"success\": true,\r\n\t\"customersImported\": [\r\n\t\t{\r\n\t\t\t\"CustomerID\": \"PestRoutesTesting1234\",\r\n\t\t\t\"PestRoutesCustomerID\": \"21044\",\r\n\t\t\t\"Action\": \"Created\"\r\n\t\t}\r\n\t],\r\n\t\"processingTime\": \"899 milliseconds\",\r\n\t\"count\": 0\r\n}\r\n\/\/Subsequent requests:\r\n{\r\n\t\"params\": {\r\n\t\t\"endpoint\": \"import\",\r\n\t\t\"action\": \"main\",\r\n\t\t\"dataMain\": [],\r\n\t\t\"authenticationKey\": \"xxx\",\r\n\t\t\"authenticationToken\": \"xxx\"\r\n\t},\r\n\t\"requestAction\": \"main\",\r\n\t\"endpoint\": \"import\",\r\n\t\"success\": true,\r\n\t\"customersImported\": [\r\n\t\t{\r\n\t\t\t\"CustomerID\": \"PestRoutesTesting1234\",\r\n\t\t\t\"PestRoutesCustomerID\": \"21044\",\r\n\t\t\t\"Action\": \"Updated\"\r\n\t\t}\r\n\t],\r\n\t\"processingTime\": \"808 milliseconds\",\r\n\t\"count\": 0\r\n}\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n\r\n<h3>Search for customers<\/h3>\r\n<section>\r\n\t<p>Search for customer by by dateUpdated<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('customer',{\r\n\t\"dateUpdated\":{\r\n\t\t\"operator\":\">\",\r\n\t\t\"value\":\"2019-09-27 00:00:00\"\r\n\t}\r\n}).then(console.log);\r\n\t<\/code>\r\n\r\n\t<h4>JQuery<\/h4>\r\n\t<code class='closed'>\r\n$.post(\"https:\/\/demo.pestroutes.com\/api\/customer\/search\",\r\n{\r\n\t\"authenticationKey\": \"xxx\",\r\n\t\"authenticationToken\": \"xxx\",\r\n\t\"dateUpdated\":{\r\n\t\t\"operator\":\">\",\r\n\t\t\"value\":\"2019-09-27 00:00:00\"\r\n\t}\r\n}, function(response){\r\n\tconsole.log(response);\r\n},\"JSON\");\r\n\t<\/code>\r\n\r\n\t<h4>CURL<\/h4>\r\n\t<code class='closed'>\r\ncurl 'https:\/\/demo.pestroutes.com\/api\/customer\/search' -H 'Accept: application\/json, text\/javascript, *\/*; q=0.01' -H 'Sec-Fetch-Mode: cors' -H 'Content-Type: application\/x-www-form-urlencoded; charset=UTF-8' --data 'dateUpdated%5Boperator%5D=%3E&dateUpdated%5Bvalue%5D=2019-09-27+00%3A00%3A00&authenticationKey=xxx&authenticationToken=xxx' --compressed\r\n\t<\/code>\r\n\r\n\t<h4>Result<\/h4>\r\n\t<code class='closed'>\r\n{\r\n\t\"params\": {\r\n\t\t\"endpoint\": \"customer\",\r\n\t\t\"action\": \"search\",\r\n\t\t\"dateUpdated\": {\r\n\t\t\t\"operator\": \">\",\r\n\t\t\t\"value\": \"2019-09-27 00:00:00\"\r\n\t\t},\r\n\t\t\"authenticationKey\": \"xxx\",\r\n\t\t\"authenticationToken\": \"xxx\"\r\n\t},\r\n\t\"requestAction\": \"search\",\r\n\t\"endpoint\": \"customer\",\r\n\t\"success\": true,\r\n\t\"idName\": \"customerIDs\",\r\n\t\"processingTime\": \"53 milliseconds\",\r\n\t\"count\": 2,\r\n\t\"customerIDs\": [\r\n\t\t12,\r\n\t\t14\r\n\t],\r\n\t\"propertyName\": \"customerIDs\"\r\n}\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n\r\n<h3>Resolve customerIDs<\/h3>\r\n<section>\r\n\t<p>Get full objects for the given customerIDs<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.get('customer',[12,14]).then(console.log);\r\n\t<\/code>\r\n\r\n\t<h4>JQuery<\/h4>\r\n\t<code class='closed'>\r\n$.post(\"https:\/\/demo.pestroutes.com\/api\/customer\/get\",\r\n{\r\n\t\"authenticationKey\": \"xxx\",\r\n\t\"authenticationToken\": \"xxx\",\r\n\t\"customerIDs\":[12,14]\r\n}, function(response){\r\n\tconsole.log(response);\r\n},\"JSON\");\r\n\t<\/code>\r\n\r\n\t<h4>CURL<\/h4>\r\n\t<code class='closed'>\r\ncurl 'https:\/\/demo.pestroutes.com\/api\/customer\/get' -H 'Accept: application\/json, text\/javascript, *\/*; q=0.01' -H 'Sec-Fetch-Mode: cors' -H 'Content-Type: application\/x-www-form-urlencoded; charset=UTF-8' --data 'customerIDs%5B%5D=12&authenticationKey=xxx&authenticationToken=xxx' --compressed\r\n\t<\/code>\r\n\r\n\t<h4>Result<\/h4>\r\n\t<code class='closed'>\r\n{\r\n\t\"params\": {\r\n\t\t\"endpoint\": \"customer\",\r\n\t\t\"action\": \"get\",\r\n\t\t\"customerIDs\": [\r\n\t\t\t\"12\",\r\n\t\t\t\"14\"\r\n\t\t],\r\n\t\t\"authenticationKey\": \"xxx\",\r\n\t\t\"authenticationToken\": \"xxx\"\r\n\t},\r\n\t\"requestAction\": \"get\",\r\n\t\"endpoint\": \"customer\",\r\n\t\"success\": true,\r\n\t\"processingTime\": \"31 milliseconds\",\r\n\t\"count\": 2,\r\n\t\"customers\": [\r\n\t\t{\r\n\t\t\t\"customerID\": \"12\",\r\n\t\t\t\"billToAccountID\": \"12\",\r\n\t\t\t\"officeID\": \"1\",\r\n\t\t\t\"fname\": \"Jane\",\r\n\t\t\t\"lname\": \"Smith\",\r\n\t\t\t\"companyName\": \"\",\r\n\t\t\t\"spouse\": null,\r\n\t\t\t\"commercialAccount\": \"0\",\r\n\t\t\t\"status\": \"1\",\r\n\t\t\t\"statusText\": \"Active\",\r\n\t\t\t\"email\": \"ivanner@pestroutes.com\",\r\n\t\t\t\"phone1\": \"\",\r\n\t\t\t\"phone2\": \"1\",\r\n\t\t\t\"address\": \"22676  Edinburgh Ln\",\r\n\t\t\t\"city\": \"WASHINGTON TOWNSHIP\",\r\n\t\t\t\"state\": \"MI\",\r\n\t\t\t\"zip\": \"48095\",\r\n\t\t\t\"billingCompanyName\": \"\",\r\n\t\t\t\"billingFName\": \"Jane\",\r\n\t\t\t\"billingLName\": \"Smith\",\r\n\t\t\t\"billingCountryID\": \"US\",\r\n\t\t\t\"billingAddress\": \"22676  Edinburgh Ln\",\r\n\t\t\t\"billingCity\": \"McKinney\",\r\n\t\t\t\"billingState\": \"TX\",\r\n\t\t\t\"billingZip\": \"75069\",\r\n\t\t\t\"billingPhone\": \"\",\r\n\t\t\t\"billingEmail\": \"ivanner@pestroutes.com\",\r\n\t\t\t\"lat\": \"55.953251\",\r\n\t\t\t\"lng\": \"-3.188267\",\r\n\t\t\t\"squareFeet\": \"0\",\r\n\t\t\t\"addedByID\": \"61\",\r\n\t\t\t\"dateAdded\": \"2012-08-31 20:17:00\",\r\n\t\t\t\"dateCancelled\": \"0000-00-00 00:00:00\",\r\n\t\t\t\"dateUpdated\": \"2019-09-27 11:29:06\",\r\n\t\t\t\"sourceID\": \"1\",\r\n\t\t\t\"source\": \"Door to Door\",\r\n\t\t\t\"aPay\": \"CC\",\r\n\t\t\t\"preferredTechID\": \"0\",\r\n\t\t\t\"paidInFull\": \"0\",\r\n\t\t\t\"subscriptionIDs\": \"10338\",\r\n\t\t\t\"balance\": \"0.00\",\r\n\t\t\t\"balanceAge\": \"0\",\r\n\t\t\t\"responsibleBalance\": \"-1167.25\",\r\n\t\t\t\"responsibleBalanceAge\": \"0\",\r\n\t\t\t\"customerLink\": \"0\",\r\n\t\t\t\"masterAccount\": \"0\",\r\n\t\t\t\"preferredBillingDate\": \"0\",\r\n\t\t\t\"paymentHoldDate\": \"2019-08-07 13:09:40\",\r\n\t\t\t\"mostRecentCreditCardLastFour\": null,\r\n\t\t\t\"mostRecentCreditCardExpirationDate\": null,\r\n\t\t\t\"appointmentIDs\": \"12,5465,6213,7825,8020,8044,8394,8547,8595,8895,9251,9662,10187,10369,10399,22798,22911,22918,22925,23592,23627,24075,24173,30014\",\r\n\t\t\t\"ticketIDs\": \"1341,1575,2371,38855\",\r\n\t\t\t\"paymentIDs\": \"4037,5790,12091,12092\",\r\n\t\t\t\"unitIDs\": []\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"customerID\": \"14\",\r\n\t\t\t\"billToAccountID\": \"14\",\r\n\t\t\t\"officeID\": \"1\",\r\n\t\t\t\"fname\": \"John\",\r\n\t\t\t\"lname\": \"Johnsons\",\r\n\t\t\t\"companyName\": \"\",\r\n\t\t\t\"spouse\": null,\r\n\t\t\t\"commercialAccount\": \"0\",\r\n\t\t\t\"status\": \"1\",\r\n\t\t\t\"statusText\": \"Active\",\r\n\t\t\t\"email\": \"davinggg@hotmail.com\",\r\n\t\t\t\"phone1\": \"2312312341\",\r\n\t\t\t\"phone2\": \"1\",\r\n\t\t\t\"address\": \"63287  Worchester Lan\",\r\n\t\t\t\"city\": \"wylie\",\r\n\t\t\t\"state\": \"TX\",\r\n\t\t\t\"zip\": \"75098\",\r\n\t\t\t\"billingCompanyName\": \"\",\r\n\t\t\t\"billingFName\": \"John\",\r\n\t\t\t\"billingLName\": \"Johnsons\",\r\n\t\t\t\"billingCountryID\": \"US\",\r\n\t\t\t\"billingAddress\": \"63287  Worchester Lan\",\r\n\t\t\t\"billingCity\": \"wylie\",\r\n\t\t\t\"billingState\": \"TX\",\r\n\t\t\t\"billingZip\": \"75098\",\r\n\t\t\t\"billingPhone\": \"2312312341\",\r\n\t\t\t\"billingEmail\": \"davinggg@hotmail.com\",\r\n\t\t\t\"lat\": \"33.254177\",\r\n\t\t\t\"lng\": \"-111.555054\",\r\n\t\t\t\"squareFeet\": \"0\",\r\n\t\t\t\"addedByID\": \"50\",\r\n\t\t\t\"dateAdded\": \"2012-08-31 20:16:00\",\r\n\t\t\t\"dateCancelled\": \"0000-00-00 00:00:00\",\r\n\t\t\t\"dateUpdated\": \"2019-09-27 11:29:18\",\r\n\t\t\t\"sourceID\": \"1\",\r\n\t\t\t\"source\": \"Door to Door\",\r\n\t\t\t\"aPay\": \"CC\",\r\n\t\t\t\"preferredTechID\": \"0\",\r\n\t\t\t\"paidInFull\": \"0\",\r\n\t\t\t\"subscriptionIDs\": \"9097\",\r\n\t\t\t\"balance\": \"0.00\",\r\n\t\t\t\"balanceAge\": \"0\",\r\n\t\t\t\"responsibleBalance\": \"-434.96\",\r\n\t\t\t\"responsibleBalanceAge\": \"0\",\r\n\t\t\t\"customerLink\": \"\",\r\n\t\t\t\"masterAccount\": \"6196\",\r\n\t\t\t\"preferredBillingDate\": \"0\",\r\n\t\t\t\"paymentHoldDate\": \"2018-10-11 00:00:00\",\r\n\t\t\t\"mostRecentCreditCardLastFour\": null,\r\n\t\t\t\"mostRecentCreditCardExpirationDate\": null,\r\n\t\t\t\"appointmentIDs\": \"14,6215,9768,9806,10280,10339,11018,11547,11576,13562,13563,13564,14801,17258,20037,22368,22371,24171,26130,26135,26138,26712,26794,28042,28547,29083,29592,30312,31984,32268,32367,33385\",\r\n\t\t\t\"ticketIDs\": \"2486,15924,17997,18001,18002,18003,18004,18075,21503,27982,29301,38848\",\r\n\t\t\t\"paymentIDs\": \"1927,2157,2159,7155,10233,11288,11782,11792,11794\",\r\n\t\t\t\"unitIDs\": []\r\n\t\t}\r\n\t],\r\n\t\"propertyName\": \"customers\"\r\n}\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>Payment Profile<\/h3>\r\n<section>\r\n\t<p>Stand alone payment profile creation<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.call('customer','createPaymentProfile',{\r\n\t\"customerID\":21049,\r\n\t\"billingAddress1\":\"Updated Billing Address\",\r\n\t\"billingCity\":\"Updated Billing City\",\r\n\t\"billingState\":\"UT\",\r\n\t\"billingZip\":\"84401\",\r\n\t\"billingCountryID\":\"US\",\r\n\r\n\t\/\/NMI\r\n\t\/\/\"CreditCardTokenID\": '170925044'\r\n\r\n\t\/\/Element\r\n\t\"CreditCardToken\":'F33F5BB8-142A-4AC8-BD39-1CD523C7A059'\r\n\r\n\t\/\/Braintree\r\n\t\/\/\"CreditCardTokenID\":'7qf8yk',\r\n\t\/\/\"CreditCardToken\":'506160933'\r\n});\r\n\t<\/code>\r\n<\/section>\r\n\r\n\r\n<h3>Search for a lot of customers and resolve<\/h3>\r\n<section>\r\n\t<p>The 'get' endpoint limits the number of results to 1000 entities at a time. The search endpoint returns a maximum of 50,000 IDs at a time. This demo document includes a function 'apiModule.staggeredRequest' that will resolve entity data in groups of 1000 while capping concurrent requests at 4. The function 'apiModule.search' demonstrates the logic necessary to resolve requests with subsequent searchs by adding the filter for primaryID > last ID from previous request.<\/p>\r\n\t<h4>Example<\/h4>\r\n\t<button class='run'>Execute<\/button>\r\n\t<code>\r\napiModule.search('customer',{\r\n\t'dateAdded':{\r\n\t\t'operator':'BETWEEN',\r\n\t\t'value':[\r\n\t\t\t'2010-01-01','2016-01-01'\r\n\t\t]\r\n\t},\r\n})\r\n.then(function(result){\r\n\treturn apiModule.staggeredRequest('customer', result);\r\n})\r\n.then(console.log);\r\n\t<\/code>\r\n<\/section>\r\n\r\n<!--\r\nlet xhr = new XMLHttpRequest();\r\nvar theUrl = \"\/json-handler\";\r\nxhr.open(\"POST\", 'https:\/\/michaelb.pestroutes.com\/api\/customer\/search');\r\nxhr.setRequestHeader(\"Content-Type\", \"application\/json;charset=UTF-8\");\r\nxhr.send(JSON.stringify({\r\n\t'dateUpdated':{\r\n\t\t'operator':'>',\r\n\t\t'value':'2021-01-01'\r\n\t},\r\n\t'authenticationKey'  :'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa',\r\n\t'authenticationToken':'1111111111111111111111111111111111111111111111111111111111111111'\r\n}));\r\n\r\nxhr.onreadystatechange = function() {\r\n\tif(this.readyState == 4 && this.status == 200){\r\n\t\tresult = JSON.parse(this.responseText);\r\n\t\tconsole.log(result);\r\n\t}\r\n};\r\n-->"; return o;},"example_proxy":function(data, save_data){ var o="\r\n<h3>Load a key for proxy usage<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.loadKeyset('proxy',{\r\n\t\"base_url\":\"\/api\/proxy\/send\/\",\r\n\t\"keys\":[\"does not matter\"],\r\n\t\"tokens\":[\"does not matter\"],\r\n},1);\r\n<\/code>\r\n\r\n<h3>PHP basic proxy code<\/h3>\r\n<code class='example_code'>\r\n&lt;?php\n\/\/This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License\n\/\/ http:\/\/creativecommons.org\/licenses\/by-sa\/4.0\/\n\n\/* .htaccess file\nRewriteEngine On\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteRule ^(.*)$ index.php?\/$1 [L]\n*\/\n$instance = new Proxy();\nClass Proxy{\n\tprivate static $url   = &#039;https:\/\/stagingdemo.pestroutes.com\/api\/&#039;;\n\tprivate static $key   = &#039;88492884d8154febd1057372867c2e34b371d8fb&#039;;\n\tprivate static $token = &#039;6915e71f53708f17dba090febd2df4f9d79364d7&#039;;\n\t\n\t\/\/ URL handler - Passes parts to function arguments - domain.com\/function\/arg1\/arg2?query=string\n\tfunction __construct(){\n\t\t\/\/Get arguments from the path\n\t\t$request_parts=explode(&#039;?&#039;,$_SERVER[&#039;REQUEST_URI&#039;]);\n\t\t$request_uri=$request_parts[0];\n\t\t\/\/We don&#039;t do anything with the query string as we use POST, but you could decode\n\t\t$query_string=@isset($request_parts[1])?$request_parts[1]:&#039;&#039;; \n\t\t$args=explode(&#039;\/&#039;, str_replace(&#039;index.php\/&#039;,&#039;&#039;,$request_uri) );\n\t\t\n\t\tif($args[0]==&#039;&#039;)\n\t\t  array_shift($args); \/\/ we don&#039;t need this bit if it&#039;s empty\n\t\t$function = preg_replace(&quot;\/[^A-Za-z0-9 _\\-]\/&quot;, &#039;&#039;, array_shift($args) );\/\/Sanitize the function name\n\t\tif($function==&#039;&#039;){ \/\/no uri, retrieve an app shell (html file)\n\t\t\t$this-&gt;index();\n\t\t}else if( method_exists( $this, $function) ){ \/\/If it&#039;s a public method below, invoke it\n\t\t\t$reflection = new ReflectionMethod($this, $function);\n\t\t\tif( $reflection-&gt;isPublic() )\n\t\t\t\tcall_user_func_array( array($this, $function), $args );\n\t\t}\n\t}\n\tpublic static function send( $request, $endpoint, $action){\n\t\ttry{\n\t\t\t$request[&#039;authenticationKey&#039;]  =self::$key;\n\t\t\t$request[&#039;authenticationToken&#039;]=self::$token;\n\t\t\t\n\t\t\t$url = self::$url.$endpoint.&#039;\/&#039;.$action;\n\t\t\t\n\t\t\t$ch = curl_init($url);\n\t\t\tcurl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($request));\n\t\t\tcurl_setopt($ch, CURLOPT_HTTPHEADER, array(&#039;Content-Type:application\/json&#039;));\n\t\t\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\t\t\t$result = curl_exec($ch);\n\t\t\t$result=json_decode($result, true);\n\t\t\t$result[&#039;params&#039;][&#039;authenticationKey&#039;]=&#039;xxx&#039;;\n\t\t\t$result[&#039;params&#039;][&#039;authenticationToken&#039;]=&#039;xxx&#039;;\n\t\t\t\n\t\t\tdie(json_encode($result));\n\t\t} catch(Exception $e){\n\t\t\tdie(json_encode([\n\t\t\t\t&#039;success&#039;=&gt;false,\n\t\t\t\t&#039;errorMessage&#039;=&gt;&#039;Proxy: &#039;.$e-&gt;getMessage()\n\t\t\t]));\n\t\t}\n\t}\n\tpublic function index(){\n\t\techo &#039;Hello World&#039;;\/\/include &#039;homepage.php&#039;;\n\t}\n}<\/code>\r\n"; return o;},"example_search":function(data, save_data){ var o="\r\n<h3>Search for customerIDs unfiltered (50k limit)<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{}).then(console.log);\r\n<\/code>\r\n\r\n\r\n<h3>Search for customerIDs unfiltered (requery to fetch full result)<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\nvar fullResult=true;\r\napiModule.search('customer',{},fullResult).then(console.log);\r\n<\/code>\r\n\r\n<h3>Search for customers (50k limit) and includeData (1k entity limit)<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'includeData':1\r\n}).then(console.log);\r\n<\/code>\r\n\r\n<h3>Search for customers and includeData, resolve all IDs ands entities staggered<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\nvar fullResult=true;\r\napiModule.search('customer',{\r\n\t'includeData':1\r\n}, fullResult).then(console.log);\r\n<\/code>\r\n\r\n<h3>Search for customers updated since last check-in<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'dateUpdated':{\r\n\t\t'operator':'>',\r\n\t\t'value':'2022-03-01 00:00:00'\r\n\t},\r\n\t'includeData':1\r\n},1).then(console.log);\r\n<\/code>\r\n\r\n<h3>Search for customer globally (all offices) by phone number<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'officeIDs':0,\r\n\t'phone':'5558675309',\r\n\t'includeData':1\r\n}).then(console.log);\r\n<\/code>\r\n\r\n<h3>Search for customers with a balance older than 7 days<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'balanceAge':{\r\n\t\t'operator':'>',\r\n\t\t'value':'7'\r\n\t},\r\n\t'includeData':1\r\n}).then(console.log);\r\n<\/code>\r\n\r\n<h3>Download all customers with a balance older than 7 days<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'balanceAge':{\r\n\t\t'operator':'>',\r\n\t\t'value':'7'\r\n\t},\r\n\t'includeData':1\r\n},1).then(apiModule.download);\r\n<\/code>\r\n\r\n<h3>Download all invoices with a balance as JSON<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('ticket',{\r\n\t'balance':{\r\n\t\t'operator':'>',\r\n\t\t'value':'0'\r\n\t},\r\n\t'includeData':1\r\n},1).then(apiModule.downloadJSON);\r\n<\/code>\r\n\r\n<h3>Download all customers globally<\/h3>\r\n<button class='run'>Execute<\/button>\r\n<code class='example_code'>\r\napiModule.search('customer',{\r\n\t'officeIDs':0,\r\n\t'includeData':1\r\n},1).then(apiModule.download);\r\n<\/code>"; return o;},"example_section":function(data, save_data){ var o="<section id='example_"+ m.out(data.example) +"' class='example_section'>\r\n\t<div class='example_overlay'><\/div>\r\n\t<h3 class='example_header'>"+ m.out(data.title) +"<\/h3>\r\n\t"+ m.build("example_"+data["example"]+"", data, save_data) +"\r\n<\/section>"; return o;},"page_documentation":function(data, save_data){ var o="<div class='documentation'>\n\t<nav class='documentation_nav'>\n\t\t<h4 class='documentation_nav_header'>Endpoints<\/h4>\n\t<\/nav>\n\t<section class='documentation_content'>Loading...<\/section>\n<\/div><script id=\""+ m.out(data.Template_id) +"_driver\">\n(function () {\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\n\tvar display = driver.prev(); driver.remove();\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\n\t\n\t\/\/Get the documentation live and unwrap the endpoints\n\tapiModule.call('documentation','swagger',{})\n\t.then(function(docs){\n\t\t\/\/save docs to window for later\n\t\twindow.swagger=docs;\n\t\tbuildPaths(docs);\n\t},function(){ \/\/fail - use stale copy\n\t\tbuildPaths(window.swagger);\n\t});\n\t\n\tvar buildPaths=function(docs){\n\t\t\/\/$('<pre>'+JSON.stringify(docs,null,\"\\t\")+'<\/pre>').appendTo(display);\n\t\tdisplay.find('.documentation_content').html(' ');\n\t\tlet nav = display.find('.documentation_nav');\n\t\tfor(var path in docs.paths){\n\t\t\t\n\t\t\t$(Template.build('documentation_nav_item',{'path':path,...docs.paths[path].post})).appendTo(nav);\n\t\t\n\t\t\t$(Template.build('path_documentation',{\n\t\t\t\t...docs.paths[path],\n\t\t\t\t'path':path\n\t\t\t})).appendTo(display.find('.documentation_content'));\n\t\t}\n\t};\n\t\n\tconsole.log('Hint: Print this page for a handy reference sheet of endpoints that were discussed. :)');\n})(Template);\n<\/script>"; return o;},"page_examples":function(data, save_data){ var o="<section class='page_examples page_section'>\r\n\t<div class='downloads'><\/div>\r\n\t\r\n\t\t\t\r\n\t<section class='pre_line'>\r\nThis document contains a JavaScript module 'apiModule' that can be used to invoke calls through a simplified interface.\r\nThe module can be found <a href='resources\/APIModule.js' target= download='fieldRoutesAPIModule.js'><u>Here<\/u><\/a>.\r\n\r\nThese calls can be inspected through the network section of the web development console\r\nto observe request payloads and response data\r\n\r\nAPI documentation on individual endpoints can be found <a class='navigation_anchor' page='documentation' data='' href='\/documentation'><u>Here<\/u><\/a>.\r\n\t<\/section>\r\n\t\r\n\t<nav class='example_nav'>\r\n\t\t<h4 class='example_nav_header'>API Workflows<\/h4>\r\n\t\t<a href='#example_search' class='example_nav_item'>Search Examples<\/a>\r\n\t\t<a href='#example_customer_create' class='example_nav_item'>Create\/Update customers<\/a>\r\n\t\t<a href='#example_subscription_create' class='example_nav_item'>Create\/Update subscriptions and leads<\/a>\r\n\t\t<a href='#example_payment_profile_create' class='example_nav_item'>Create\/Update a Payment Profile<\/a>\r\n\t\t<a href='#example_document_upload' class='example_nav_item'>Upload Documents and Contracts<\/a>\r\n\t\t<h4 class='example_nav_header'>Advanced apiModule usage<\/h4>\r\n\t\t<a href='#example_proxy' class='example_nav_item'>Proxy front-end requests to middleware<\/a>\r\n\t\t<a href='#example_load_key' class='example_nav_item'>Load Keys into apiModule<\/a>\r\n\t\t<h4 class='example_nav_header'>Other<\/h4>\r\n\t\t<a href='#example_old_examples' class='example_nav_item'>Older Examples<\/a>\r\n\t<\/nav>\r\n\t\r\n\t"+ m.build("example_section",{'example':'search','title':'Search Examples'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'customer_create','title':'Create/Update customers'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'subscription_create','title':'Create/Update subscriptions and leads'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'payment_profile_create','title':'Create/Update a Payment Profile'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'document_upload','title':'Upload documents and contracts with base64'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'proxy','title':'Proxy usage example (key obfuscation)'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'load_key','title':'Load keys into the JavaScript apiModule'}) +"\r\n\t\r\n\t"+ m.build("example_section",{'example':'old_examples','title':'Older Examples'}) +"\r\n<\/section><script id=\""+ m.out(data.Template_id) +"_driver\">\r\n(function () {\r\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\r\n\tvar display = driver.prev(); driver.remove(); delete driver;\r\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\r\n\r\n\t\/\/code block RUN driver\r\n\tdisplay.on('click', '.run', function(e){\r\n\t\tvar codeSample = $(this).nextAll('code').html();\r\n\t\tcodeSample = codeSample.replace(\/&lt;\/g, \"<\");\r\n\t\tcodeSample = codeSample.replace(\/&gt;\/g, \">\");\r\n\t\tcodeSample = codeSample.replace(\/&amp;\/g, \"&\");\r\n\t\teval(codeSample);\r\n\t});\r\n\t\r\n\t\/\/index driver\r\n\tdisplay.on('click', '.example_nav_item', function(e){\r\n\t\te.preventDefault();\r\n\t\tlet target=this.href.split(\"#\").pop();\r\n\t\t$('#'+target).addClass('open');\r\n\t\t$('#'+target)[0].scrollIntoView({behavior: \"smooth\", block: \"start\", inline: \"nearest\"});\r\n\t\t$('#'+target).one('transitionend webkitTransitionEnd oTransitionEnd',function(){\r\n\t\t\tthis.scrollIntoView({behavior: \"smooth\", block: \"start\", inline: \"nearest\"});\r\n\t\t})\r\n\t\tif(top>0){\r\n\t\t\twindow.scrollTo(top,0);\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t});\r\n\t\r\n\t\/\/example overlay driver\r\n\tdisplay.on('click', '.example_header', function(e){\r\n\t\t$(this).closest('.example_section').toggleClass('open');\r\n\t\te.stopPropagation();\r\n\t});\r\n\t\r\n\t\/\/example overlay driver\r\n\tdisplay.on('click', '.example_overlay', function(e){\r\n\t\t$(this).closest('.example_section').toggleClass('open');\r\n\t\te.stopPropagation();\r\n\t});\r\n\t\r\n\t\/\/keyset driver\r\n\tvar keyset_ui = apiModule.getKeysetUI().prependTo(display);\r\n\r\n\t\/\/deconstructor\r\n\tdisplay.on('remove',function (){\r\n\t\tdisplay.off();\r\n\t\tdelete keyset_ui;\r\n\t\tdelete display;\r\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\r\n\t});\r\n})(Template);\r\n<\/script>"; return o;},"page_faq":function(data, save_data){ var o="<section class='page_faq page_section'>\n\t<h3>Frequently Asked Questions<\/h4>\n\t<section class='pre_line'>\n\t\tCan we increase our <strong>API limits?<\/strong>\n\t\t- By default we cap premium API limits to 3000 reads 3000 writes per office at 60\/minute\n\t\t- If your API needs surpass these limits, reach out to apisupport@fieldroutes.com for a consultation.\n\t\t\n\t\tSomething went wrong! Do you have <strong>request logs<\/strong>?\n\t\t- Yes! Please reach out to apisupport@fieldroutes.com for a consultation.\n\t\t\n\t<\/section>\n<\/section>"+ m.build("tpl_destruct", data, save_data) +"\n"; return o;},"page_home":function(data, save_data){ var o="<section class='home page_section'>\n\t<section class='pre_line'>\n\t\tWelcome to the FieldRoutes API documentation!\n\t\t\n\t\tResources:\n\t\t<a class='navigation_anchor' page='documentation' data='' href='\/documentation'>\n\t\t<span class='home_icons'>\ud83d\udcd7<\/span>Documentation on individual endpoints<\/a>\n\t\t<a class='navigation_anchor' page='examples' data='' href='\/examples'>\n\t\t<span class='home_icons'>\ud83d\udc68\u200d\ud83c\udfeb<\/span>Examples and workflows<\/a>\n\t\t<a class='navigation_anchor' page='faq' data='' href='\/faq'>\n\t\t<span class='home_icons'>\u2754<\/span>Frequeuntly asked questions<\/a>\n\t\t<a class='navigation_anchor' page='tools' data='' href='\/tools'>\n\t\t<span class='home_icons'>\ud83d\udd28<\/span>Tools<\/a>\n\t\t\n\t\tThings to know:\n\t\t\n\t\t<strong>Search endpoints<\/strong> have a return limit of 50,000 IDs.\n\t\t- If you encounter a result set that has exactly 50,000 IDs, more requests will be needed\n\t\t- Filter on the primary key using operator '&gt;' with a value as the last item in the last full set\n\t\t- Continue until a set of less than 50,000 is recieved\n\t\t\n\t\t<strong>Get endpoints<\/strong> have a return limit of 1,000 entities.\n\t\t- Break requests apart to request for 1,000 entites or fewer additional inputs may be truncated\n\t\t- Sending the authentication key and token as the last input parameters can ensure that no partial request will execute successfully\n\t\t\n\t\t<strong>Global keys<\/strong> and office scope:\n\t\t- By default, each key is associated with only one office\n\t\t- Single office keys have an implied `officeIDs` filter on read requests and an `officeID` property on each write request\n\t\t- Global keys may send any `officeIDs` filter to search and any `officeID` property on writes\n\t\t\n\t\t<strong>Key grouping<\/strong>:\n\t\t- By default each key has it's own distinct read\/write limits\n\t\t- By request, keys can be grouped together such that their limits and usage are aggregated into a common pool\n\t\t\n\t\t\n\t\t\n\t<\/section>\n<\/section><script id=\""+ m.out(data.Template_id) +"_driver\">\n(function () {\n\tvar driver= $('#"+ m.out(data.Template_id) +"_driver');\n\tvar display = driver.prev(); driver.remove();\n\t\/\/var data = Template.data("+ m.out(data.Template_id) +");\n\t\n\n\tdisplay.on('remove',function (){\n\t\tdisplay.off();\n\t\tdelete driver;\n\t\tdelete display;\n\t\tTemplate.data_delete("+ m.out(data.Template_id) +");\n\t});\n})(Template);\n<\/script>\n"; return o;},"page_sell":function(data, save_data){ var o="<section class='page_section'>\r\n\t<pre>\r\nWhy should we distrubute starter code for individual company apps?\r\n\tAPI boost (30%)\r\n\tSecure contracts through sales engineering work\r\n\tSticky customers\r\n\tOur customers are interested in proprietary tools for competitive edge\r\n\tLicensing possiblity ($$$)\r\n\t\r\nWhat is the risk?\r\n\tLegal can answer this question, but plan to ship the software as-is with no warranties\r\n\r\nWhat exactly are we talking about?\r\n\tNovel ETL process (in progress)\r\n\t\tconfiguration: (endpoints to sync, rate to sync, flags to send)\r\n\t\tAuto-update schema based on swagger job\r\n\t\tdetect hard deletes\r\n\t\t\r\n\tUser based endpoint access through proxy (*\/*, customer\/*, *\/search, etc..)\r\n\tUser based authentication keys\r\n\t<\/pre>\r\n<\/section>"; return o;},"path_documentation":function(data, save_data){ var o="<div class='path_documentation'>\r\n\t"+ m.build("api_parameters",{"path":data.path, ...data.post}) +"\r\n<\/div>"; return o;}};m.config={"Company_name":"mbenji.com","Logo":"(o.O)_\\nn\/"};return m; })()